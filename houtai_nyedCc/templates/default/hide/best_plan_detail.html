{+include file='header2.html'+}
</head>
<link href="/default/css/control.css" rel="stylesheet" />
<link href="/default/css/Site.css" rel="stylesheet" />
<style>
body {
    font-family: Arial, "Microsoft YaHei", sans-serif;
    font-size: 12px;
}

.jt-container {
    padding: 10px;
}

.top_info {
    background: linear-gradient(to bottom, #f5f5f5, #e5e5e5);
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-bottom: 10px;
}

.title {
    font-size: 16px;
    font-weight: bold;
    color: #333;
}

.summary-panel {
    background: #fff;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-bottom: 20px;
}

.summary-row {
    margin-bottom: 15px;
    padding: 10px;
    background: #f9f9f9;
    border-left: 3px solid #007bff;
}

.summary-label {
    display: inline-block;
    width: 120px;
    font-weight: bold;
    color: #555;
}

.summary-value {
    color: #333;
    font-size: 14px;
}

.numbers-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
    margin: 20px 0;
}

.number-card {
    background: #fff;
    border: 2px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    transition: all 0.3s;
    cursor: pointer;
}

.number-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.number-card.best {
    background: #d4edda;
    border-color: #28a745;
}

.number-card.worst {
    background: #f8d7da;
    border-color: #dc3545;
}

.number-card.result {
    background: #fff3cd;
    border-color: #ffc107;
    box-shadow: 0 0 10px rgba(255,193,7,0.5);
}

.number {
    font-size: 24px;
    font-weight: bold;
    color: #007bff;
    margin-bottom: 5px;
}

.number-card.best .number {
    color: #28a745;
}

.number-card.worst .number {
    color: #dc3545;
}

.number-card.result .number {
    color: #ff6600;
}

.profit {
    font-size: 14px;
    margin: 5px 0;
}

.profit.positive {
    color: #28a745;
}

.profit.negative {
    color: #dc3545;
}

.rate {
    font-size: 12px;
    color: #6c757d;
}

.prize {
    font-size: 11px;
    color: #999;
}

.win-count {
    font-size: 11px;
    color: #999;
}

.badge {
    display: inline-block;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: bold;
    margin-top: 5px;
}

.badge-best {
    background: #28a745;
    color: white;
}

.badge-worst {
    background: #dc3545;
    color: white;
}

.badge-result {
    background: #ffc107;
    color: #333;
}

.btn {
    padding: 8px 20px;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    margin-right: 10px;
    text-decoration: none;
    display: inline-block;
    color: #fff;
}

.btn-primary {
    background: #007bff;
}

.btn-primary:hover {
    background: #0056b3;
}

.btn-success {
    background: #28a745;
}

.btn-info {
    background: #17a2b8;
}

.legend {
    background: #f8f9fa;
    padding: 15px;
    border: 1px solid #dee2e6;
    border-radius: 5px;
    margin-bottom: 20px;
}

.legend-item {
    display: inline-block;
    margin-right: 20px;
}

.legend-box {
    display: inline-block;
    width: 20px;
    height: 20px;
    border-radius: 3px;
    margin-right: 5px;
    vertical-align: middle;
}

.search-panel {
    background: #fff;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-bottom: 20px;
}

.search-result {
    background: #d1ecf1;
    padding: 10px;
    border: 1px solid #bee5eb;
    border-radius: 5px;
    margin-top: 10px;
}
</style>

<body>
<div class="jt-container">
    <div class="top_info">
        <span class="title">最佳控盘计划 - 详情</span>
        <span class="right">
            <a href="best_plan.php?xtype=show&gid={+$gid+}" class="btn btn-primary">返回列表</a>
            {+if !$kj_info.js+}
            <button class="btn btn-success" onclick="analyzeAgain()">重新分析</button>
            {+/if+}
        </span>
    </div>

    <!-- 汇总信息 -->
    <div class="summary-panel">
        <h3 style="margin-top:0; border-bottom:2px solid #007bff; padding-bottom:10px;">分析汇总</h3>

        <div class="summary-row">
            <span class="summary-label">期数：</span>
            <span class="summary-value" style="font-size:16px; font-weight:bold; color:#007bff;">{+$result.qishu+}</span>
        </div>

        <div class="summary-row">
            <span class="summary-label">开奖时间：</span>
            <span class="summary-value">{+$kj_info.dates+} {+$kj_info.endtime+}</span>
        </div>

        <div class="summary-row">
            <span class="summary-label">分析时间：</span>
            <span class="summary-value">{+$result.analyze_time+}</span>
        </div>

        <div class="summary-row">
            <span class="summary-label">总投注额：</span>
            <span class="summary-value" style="font-size:16px; font-weight:bold;">{+$result.total_bet_amount_fmt+} 元</span>
        </div>

        <div class="summary-row">
            <span class="summary-label">最大盈利：</span>
            <span class="summary-value" style="color:#28a745; font-size:16px; font-weight:bold;">
                {+$result.max_profit_fmt+} 元
            </span>
            <span style="margin-left:20px;">最佳号码：</span>
            <span style="color:#28a745; font-weight:bold;">{+$result.best_numbers+}</span>
        </div>

        <div class="summary-row">
            <span class="summary-label">最小盈利：</span>
            <span class="summary-value" style="color:#dc3545; font-size:16px; font-weight:bold;">
                {+$result.min_profit_fmt+} 元
            </span>
            <span style="margin-left:20px;">最差号码：</span>
            <span style="color:#dc3545; font-weight:bold;">{+$result.worst_numbers+}</span>
        </div>

        <div class="summary-row">
            <span class="summary-label">盈利差：</span>
            <span class="summary-value" style="font-size:16px; font-weight:bold;">{+$result.profit_range_fmt+} 元</span>
        </div>

        {+if $kj_info.js == 1+}
        <div class="summary-row" style="border-left-color:#ffc107; background:#fff3cd;">
            <span class="summary-label">开奖结果：</span>
            <span class="summary-value" style="font-size:18px; font-weight:bold; color:#ff6600;">
                {+$kj_info.kj1+} 号
            </span>
        </div>
        {+/if+}
    </div>

    <!-- 图例 -->
    <div class="legend">
        <strong>图例说明：</strong>
        <div class="legend-item">
            <span class="legend-box" style="background:#d4edda; border:2px solid #28a745;"></span>
            <span>最佳号码（平台盈利最高）</span>
        </div>
        <div class="legend-item">
            <span class="legend-box" style="background:#f8d7da; border:2px solid #dc3545;"></span>
            <span>最差号码（平台盈利最低）</span>
        </div>
        {+if $kj_info.js == 1+}
        <div class="legend-item">
            <span class="legend-box" style="background:#fff3cd; border:2px solid #ffc107;"></span>
            <span>实际开奖号码</span>
        </div>
        {+/if+}
    </div>

    <!-- 赔率搜索 -->
    <div class="search-panel">
        <strong>按盈利率查找：</strong>
        <label style="margin-left:20px;">最小盈利率（%）：</label>
        <input type="number" id="min_rate" value="30" style="width:80px; padding:5px;">
        <label style="margin-left:20px;">最大盈利率（%）：</label>
        <input type="number" id="max_rate" value="50" style="width:80px; padding:5px;">
        <button class="btn btn-info" onclick="findByRate()">查找</button>

        <div id="searchResult" class="search-result" style="display:none;"></div>
    </div>

    <!-- 49个号码详情 -->
    <h3 style="border-bottom:2px solid #007bff; padding-bottom:10px;">49个号码详细分析</h3>
    <div class="numbers-grid">
        {+section name=i loop=$result.details+}
        <div class="number-card {+if $result.details[i].is_best+}best{+/if+} {+if $result.details[i].is_worst+}worst{+/if+} {+if $result.details[i].is_result+}result{+/if+}">
            <div class="number">{+$result.details[i].number|string_format:"%02d"+}</div>

            <div class="profit {+if $result.details[i].profit >= 0+}positive{+else+}negative{+/if+}">
                盈利：{+$result.details[i].profit_fmt+}
            </div>

            <div class="rate">
                盈利率：{+$result.details[i].profit_rate+}%
            </div>

            <div class="prize">
                派奖：{+$result.details[i].total_prize_fmt+}
            </div>

            <div class="win-count">
                中奖数：{+$result.details[i].win_count+}
            </div>

            {+if $result.details[i].is_best+}
            <div class="badge badge-best">最佳</div>
            {+/if+}

            {+if $result.details[i].is_worst+}
            <div class="badge badge-worst">最差</div>
            {+/if+}

            {+if $result.details[i].is_result+}
            <div class="badge badge-result">实际开出</div>
            {+/if+}
        </div>
        {+/section+}
    </div>
</div>

<script src="/js/jquery.min.js"></script>
<script>
// 重新分析
function analyzeAgain() {
    if (!confirm('确定要重新分析期次 {+$result.qishu+} 吗？')) {
        return;
    }

    $.ajax({
        url: 'best_plan.php?xtype=analyze_now',
        type: 'POST',
        data: {
            qishu: '{+$result.qishu+}',
            gid: '{+$gid+}'
        },
        dataType: 'json',
        success: function(res) {
            if (res.success) {
                alert('重新分析成功');
                location.reload();
            } else {
                alert('分析失败：' + res.message);
            }
        },
        error: function() {
            alert('请求失败，请重试');
        }
    });
}

// 按盈利率查找
function findByRate() {
    var minRate = parseFloat($('#min_rate').val());
    var maxRate = parseFloat($('#max_rate').val());

    if (isNaN(minRate) || isNaN(maxRate)) {
        alert('请输入有效的盈利率');
        return;
    }

    if (minRate > maxRate) {
        alert('最小盈利率不能大于最大盈利率');
        return;
    }

    $.ajax({
        url: 'best_plan.php?xtype=find_by_rate',
        type: 'POST',
        data: {
            qishu: '{+$result.qishu+}',
            gid: '{+$gid+}',
            min_rate: minRate,
            max_rate: maxRate
        },
        dataType: 'json',
        success: function(res) {
            if (res.success) {
                if (res.data.length > 0) {
                    var html = '<strong>找到 ' + res.data.length + ' 个符合条件的号码：</strong><br>';
                    res.data.forEach(function(item) {
                        html += '<span style="display:inline-block; margin:5px; padding:5px 10px; background:#007bff; color:#fff; border-radius:3px;">';
                        html += item.number + ' 号 (盈利率: ' + item.rate + '%, 盈利: ' + item.profit + ')';
                        html += '</span>';
                    });
                    $('#searchResult').html(html).show();
                } else {
                    $('#searchResult').html('<strong>未找到符合条件的号码</strong>').show();
                }
            } else {
                alert('查询失败：' + res.message);
            }
        },
        error: function() {
            alert('请求失败，请重试');
        }
    });
}
</script>
</body>
</html>
