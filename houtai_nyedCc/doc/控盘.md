# ğŸ¯ åå°ç®¡ç†"æ§ç›˜"åŠŸèƒ½å®Œæ•´åˆ†ææŠ¥å‘Š

> æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š2025-11-09
> åˆ†æå¯¹è±¡ï¼šhoutai_nyedCc å½©ç¥¨åå°ç®¡ç†ç³»ç»Ÿ
> æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªåŠ¨é™èµ”ã€é£å•å¯¹å†²ã€é£é™©æ§åˆ¶

---

## ç›®å½•

- [ä¸€ã€åŠŸèƒ½å®šä½](#ä¸€åŠŸèƒ½å®šä½)
- [äºŒã€ä¸“ä¸šæœ¯è¯­è§£é‡Š](#äºŒä¸“ä¸šæœ¯è¯­è§£é‡Š)
- [ä¸‰ã€æ¾³é—¨å…­åˆå½©å®æˆ˜æ¡ˆä¾‹](#ä¸‰æ¾³é—¨å…­åˆå½©å®æˆ˜æ¡ˆä¾‹)
- [å››ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#å››æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
- [äº”ã€ç®¡ç†ç•Œé¢ä¸æ“ä½œæµç¨‹](#äº”ç®¡ç†ç•Œé¢ä¸æ“ä½œæµç¨‹)
- [å…­ã€æ•°æ®åº“æ“ä½œè¯¦è§£](#å…­æ•°æ®åº“æ“ä½œè¯¦è§£)

---

## ä¸€ã€åŠŸèƒ½å®šä½

**æ§ç›˜**æ˜¯å½©ç¥¨/åšå½©ç³»ç»Ÿä¸­çš„é£é™©æ§åˆ¶æ ¸å¿ƒåŠŸèƒ½ï¼Œé€šè¿‡**è‡ªåŠ¨è°ƒæ•´èµ”ç‡**å’Œ**é™åˆ¶æŠ•æ³¨é¢**æ¥é™ä½åº„å®¶é£é™©ã€‚

**æ ¸å¿ƒç›®æ ‡**ï¼š
- é˜²æ­¢ç”¨æˆ·é›†ä¸­æŠ•æ³¨æŸä¸ªå·ç å¯¼è‡´åº„å®¶å¤§é¢äºæŸ
- è‡ªåŠ¨å¹³è¡¡å„ç©æ³•çš„æŠ•æ³¨åˆ†å¸ƒ
- å®æ—¶ç›‘æ§å¼‚å¸¸æŠ•æ³¨è¡Œä¸º

---

## äºŒã€ä¸“ä¸šæœ¯è¯­è§£é‡Š

### ğŸ“š **æ ¸å¿ƒæœ¯è¯­è¡¨**

| æœ¯è¯­ | è‹±æ–‡ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|------|
| **æ§ç›˜** | Risk Control | é€šè¿‡è°ƒæ•´èµ”ç‡ã€é™åˆ¶æŠ•æ³¨é¢ç­‰æ‰‹æ®µæ§åˆ¶é£é™© | æŸå·ç æŠ•æ³¨è¿‡å¤šï¼Œè‡ªåŠ¨é™ä½è¯¥å·ç èµ”ç‡ |
| **é™èµ”** | Reduce Odds | é™ä½èµ”ç‡ä»¥å‡å°‘æ½œåœ¨èµ”ä»˜é‡‘é¢ | èµ”ç‡ä» 1.95 é™è‡³ 1.90 |
| **é£å•** | Hedge Bet | å°†ä¸‹çº§æŠ•æ³¨è½¬ç§»åˆ°ä¸Šçº§è´¦æˆ·ï¼Œåˆ†æ•£é£é™© | ä¸‹çº§æŠ•æ³¨ 10000 å…ƒï¼Œä¸Šçº§è‡ªåŠ¨è·ŸæŠ• 10000 å…ƒ |
| **è¡¥è´§** | Auto Fill | é£å•çš„å¦ä¸€ç§è¯´æ³•ï¼Œè‡ªåŠ¨è¡¥å……ä¸Šçº§ä»“ä½ | åŒ"é£å•" |
| **å¯¹å†²** | Hedging | åœ¨ç¬¬ä¸‰æ–¹å¹³å°ä¸‹åå‘æ³¨å•ï¼Œé”å®šåˆ©æ¶¦ | æœ¬å¹³å°ç©å®¶ä¹°"å¤§"ï¼Œåˆ°å…¶ä»–å¹³å°ä¹°"å°" |
| **å æˆ** | Commission Rate | ä»£ç†æˆ–ç³»ç»Ÿä»æŠ•æ³¨é¢ä¸­æŠ½å–çš„æ¯”ä¾‹ | å æˆ 30%ï¼Œ10000 å…ƒæŠ•æ³¨ï¼Œç³»ç»Ÿå  3000 å…ƒ |
| **èµ”ç‡** | Odds | ä¸­å¥–åçš„èµ”ä»˜å€æ•° | èµ”ç‡ 1.95ï¼ŒæŠ•æ³¨ 100 å…ƒä¸­å¥–å¾— 195 å…ƒ |
| **åŒ…ç ** | Number Blocking | é™åˆ¶å•ä¸ªå·ç çš„æœ€å¤§æŠ•æ³¨é¢ | å·ç "01"æœ€å¤šæŠ•æ³¨ 5 ä¸‡å…ƒ |
| **å°ç›˜** | Close Market | åœæ­¢æ¥å—æŠ•æ³¨ | æŠ•æ³¨é¢è¿‡å¤§ï¼Œæå‰å°ç›˜ |
| **å¼€ç›˜** | Open Market | å¼€å§‹æ¥å—æŠ•æ³¨ | æ¯æœŸå¼€å¥–åè‡ªåŠ¨å¼€ç›˜ |
| **æœŸå·** | Issue Number | å½©ç¥¨çš„å¼€å¥–æ‰¹æ¬¡ç¼–å· | 2025001ï¼ˆ2025 å¹´ç¬¬ 1 æœŸï¼‰ |
| **ç©æ³•** | Game Type | æŠ•æ³¨çš„å…·ä½“æ–¹å¼ | ç‰¹ç ä¸¤é¢ï¼ˆå¤§å°/å•åŒï¼‰ã€æ­£ç ã€è¿ç ç­‰ |
| **ä¸¤é¢** | Two-Way Bet | äºŒé€‰ä¸€çš„ç©æ³• | å¤§/å°ã€å•/åŒã€çº¢/è“ |
| **ç‰¹ç ** | Special Number | å…­åˆå½©æœ€åä¸€ä¸ªå¼€å¥–å·ç  | å¼€å¥–å·ç  [01,12,23,34,45,49,**38**]ï¼Œç‰¹ç =38 |
| **æ­£ç ** | Normal Number | å‰å…­ä¸ªå¼€å¥–å·ç  | æ­£ç  1-6ï¼š01,12,23,34,45,49 |
| **A/B/C/D ç›˜** | Market Level | ä¸åŒä¼šå‘˜ç­‰çº§çš„èµ”ç‡æ–¹æ¡ˆ | Aç›˜æœ€é«˜ï¼ŒDç›˜æœ€ä½ |
| **ä¸Šæ°´** | Rebate | ä»£ç†ç»™ä¸‹çº§çš„è¿”ä½£æ¯”ä¾‹ | ä¸Šæ°´ 5%ï¼ŒæŠ•æ³¨ 10000 å…ƒè¿” 500 å…ƒ |
| **çˆ†ç ** | Hot Number | æŠ•æ³¨è¿‡äºé›†ä¸­çš„å·ç  | å·ç "01"è¢«å¤§é‡æŠ•æ³¨ï¼Œè§¦å‘é™èµ” |

---

### ğŸ” **æ§ç›˜ç›¸å…³æœ¯è¯­è¯¦è§£**

#### **1. é£å•ï¼ˆHedge Betï¼‰**

**å®šä¹‰**ï¼šå°†ä¸‹çº§ä»£ç†æˆ–ç”¨æˆ·çš„æŠ•æ³¨ï¼Œè‡ªåŠ¨å¤åˆ¶åˆ°ä¸Šçº§è´¦æˆ·ï¼ˆé€šå¸¸æ˜¯ç³»ç»Ÿè´¦æˆ·ï¼‰ï¼Œå®ç°é£é™©åˆ†æ•£ã€‚

**ä¸ºä»€ä¹ˆè¦é£å•ï¼Ÿ**
- **åˆ†æ•£é£é™©**ï¼šé¿å…å•ä¸ªè´¦æˆ·æ‰¿æ‹…è¿‡å¤§èµ”ä»˜å‹åŠ›
- **å¹³è¡¡ç›ˆäº**ï¼šä¸Šä¸‹çº§å…±åŒæ‰¿æ‹…é£é™©å’Œåˆ©æ¶¦
- **é£æ§éœ€è¦**ï¼šé˜²æ­¢æŸä¸ªä»£ç†å› å·¨é¢èµ”ä»˜ç ´äº§

**é£å•æµç¨‹ç¤ºæ„**ï¼š
```
ç”¨æˆ·Aï¼ˆ10001ï¼‰ â†’ æŠ•æ³¨ 1000 å…ƒä¹°"å¤§"
    â†“
ä»£ç†Bï¼ˆ10002ï¼‰ â†’ å æˆ 30%ï¼Œæ‰¿æ‹… 300 å…ƒé£é™©
    â†“
ç³»ç»Ÿï¼ˆ99999999ï¼‰ â†’ å æˆ 70%ï¼Œé£å• 700 å…ƒåˆ°ç³»ç»Ÿè´¦æˆ·
```

**æ•°æ®åº“ä½“ç°**ï¼š
```sql
-- ç”¨æˆ·Açš„åŸå§‹æŠ•æ³¨
INSERT INTO x_lib (userid, je, zc0, zc1, flytype, xtype)
VALUES (10001, 1000, 70, 30, 0, 1);

-- ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„é£å•
INSERT INTO x_lib (userid, je, zc0, flytype, xtype)
VALUES (99999999, 700, 100, 1, 1);
-- flytype=1 è¡¨ç¤ºé£å•
```

---

#### **2. å æˆï¼ˆCommission Rateï¼‰**

**å®šä¹‰**ï¼šä»£ç†æˆ–ç³»ç»Ÿä»æ¯ç¬”æŠ•æ³¨ä¸­å æœ‰çš„é£é™©æ¯”ä¾‹ã€‚

**å æˆè®¡ç®—ç¤ºä¾‹**ï¼š
```
ç”¨æˆ·æŠ•æ³¨ï¼š10000 å…ƒ
ç³»ç»Ÿå æˆï¼ˆzc0ï¼‰ï¼š70%  â†’ ç³»ç»Ÿæ‰¿æ‹…é£é™© 7000 å…ƒ
ä¸€çº§ä»£ç†å æˆï¼ˆzc1ï¼‰ï¼š20%  â†’ ä¸€çº§ä»£ç†æ‰¿æ‹… 2000 å…ƒ
äºŒçº§ä»£ç†å æˆï¼ˆzc2ï¼‰ï¼š10%  â†’ äºŒçº§ä»£ç†æ‰¿æ‹… 1000 å…ƒ

å¦‚æœä¸­å¥–èµ”ç‡ 1.95ï¼š
- æ€»èµ”ä»˜ï¼š10000 Ã— 1.95 = 19500 å…ƒ
- ç³»ç»Ÿæ”¯ä»˜ï¼š19500 Ã— 70% = 13650 å…ƒ
- ä¸€çº§ä»£ç†æ”¯ä»˜ï¼š19500 Ã— 20% = 3900 å…ƒ
- äºŒçº§ä»£ç†æ”¯ä»˜ï¼š19500 Ã— 10% = 1950 å…ƒ
```

**æ•°æ®åº“å­—æ®µ**ï¼š
- `zc0`ï¼šç³»ç»Ÿå æˆï¼ˆ0-100ï¼‰
- `zc1`ï¼šä¸€çº§ä»£ç†å æˆ
- `zc2`ï¼šäºŒçº§ä»£ç†å æˆ
- ...æœ€å¤šæ”¯æŒ 8 çº§ä»£ç†ï¼ˆzc0-zc8ï¼‰

---

#### **3. é™èµ”ï¼ˆReduce Oddsï¼‰**

**å®šä¹‰**ï¼šå½“æŸä¸ªç©æ³•æŠ•æ³¨é¢è¿‡å¤§æ—¶ï¼Œè‡ªåŠ¨é™ä½èµ”ç‡ä»¥å‡å°‘æ½œåœ¨èµ”ä»˜ã€‚

**ä¸ºä»€ä¹ˆè¦é™èµ”ï¼Ÿ**
- **é£é™©æ§åˆ¶**ï¼šé˜²æ­¢å•ä¸ªç©æ³•èµ”ä»˜è¿‡å¤š
- **åˆ©æ¶¦ä¿æŠ¤**ï¼šç¡®ä¿åº„å®¶ç›ˆåˆ©ç©ºé—´
- **å¸‚åœºå¹³è¡¡**ï¼šå¼•å¯¼ç”¨æˆ·åˆ†æ•£æŠ•æ³¨

**é™èµ”è§¦å‘æ¡ä»¶**ï¼š
```
IF (æŠ•æ³¨é¢ >= è§¦å‘é‡‘é¢) THEN
    é™èµ”æ¬¡æ•° = FLOOR((æŠ•æ³¨é¢ - è§¦å‘é‡‘é¢) / é€’å¢é‡‘é¢) + 1
    å½“å‰èµ”ç‡ = åŸå§‹èµ”ç‡ - åˆå§‹é™å¹… - (é™èµ”æ¬¡æ•° - 1) Ã— é€’å¢é™å¹…
    å½“å‰èµ”ç‡ = MAX(å½“å‰èµ”ç‡, æœ€ä½èµ”ç‡)
END IF
```

**å®é™…æ¡ˆä¾‹**ï¼š
```
åŸå§‹èµ”ç‡ï¼š1.95
è§¦å‘é‡‘é¢ï¼š10000 å…ƒ
åˆå§‹é™å¹…ï¼š0.01
é€’å¢é‡‘é¢ï¼š5000 å…ƒ
é€’å¢é™å¹…ï¼š0.02
æœ€ä½èµ”ç‡ï¼š1.80

å½“å‰æŠ•æ³¨é¢ï¼š25000 å…ƒ
é™èµ”æ¬¡æ•° = (25000 - 10000) / 5000 + 1 = 4
å½“å‰èµ”ç‡ = 1.95 - 0.01 - (4-1)Ã—0.02 = 1.88
```

---

#### **4. åŒ…ç ï¼ˆNumber Blockingï¼‰**

**å®šä¹‰**ï¼šé™åˆ¶å•ä¸ªå·ç çš„æœ€å¤§æŠ•æ³¨æ€»é¢ï¼Œè¶…è¿‡åè‡ªåŠ¨å°ç›˜æˆ–é™èµ”ã€‚

**åº”ç”¨åœºæ™¯**ï¼š
- **é˜²æ­¢å†…å¹•äº¤æ˜“**ï¼šæœ‰äººæå‰çŸ¥é“å¼€å¥–å·ç ï¼Œé›†ä¸­æŠ•æ³¨
- **é£é™©åˆ†æ•£**ï¼šé¿å…å•ä¸ªå·ç èµ”ä»˜è¿‡é«˜
- **å¼‚å¸¸ç›‘æ§**ï¼šæ£€æµ‹å¯ç–‘æŠ•æ³¨è¡Œä¸º

**åŒ…ç æ§åˆ¶é€»è¾‘**ï¼š
```php
// ç»Ÿè®¡æŸä¸ªå·ç çš„æ€»æŠ•æ³¨é¢
$total = SELECT SUM(je) FROM x_lib
         WHERE gid='300' AND qishu='2025001'
         AND content='01';  // å·ç 01

IF ($total > 50000) {
    // æ–¹æ³•1ï¼šé™ä½è¯¥å·ç èµ”ç‡
    UPDATE x_play SET peilv1 = peilv1 - 0.05
    WHERE content='01';

    // æ–¹æ³•2ï¼šç¦æ­¢ç»§ç»­æŠ•æ³¨è¯¥å·ç 
    UPDATE x_play SET ifok=0
    WHERE content='01';
}
```

---

#### **5. A/B/C/D ç›˜ï¼ˆMarket Levelï¼‰**

**å®šä¹‰**ï¼šé’ˆå¯¹ä¸åŒç­‰çº§ä¼šå‘˜è®¾ç½®çš„èµ”ç‡æ–¹æ¡ˆã€‚

**ç›˜å£å·®å¼‚**ï¼š
```
åŒä¸€ä¸ªç©æ³•"ç‰¹ç å¤§å°"ï¼š
- A ç›˜ï¼ˆVIPä¼šå‘˜ï¼‰ï¼šèµ”ç‡ 1.95ï¼Œä¸Šæ°´ 0%
- B ç›˜ï¼ˆæ™®é€šä¼šå‘˜ï¼‰ï¼šèµ”ç‡ 1.92ï¼Œä¸Šæ°´ 2%
- C ç›˜ï¼ˆæ–°ä¼šå‘˜ï¼‰ï¼šèµ”ç‡ 1.90ï¼Œä¸Šæ°´ 3%
- D ç›˜ï¼ˆè¯•ç©è´¦æˆ·ï¼‰ï¼šèµ”ç‡ 1.85ï¼Œä¸Šæ°´ 5%
```

**æ•°æ®åº“é…ç½®**ï¼ˆx_config è¡¨ï¼‰ï¼š
```json
{
  "patt1": {"ä¸¤é¢": {"ab": 0, "b": 0, "c": 0.03, "d": 0.05}},  // Aç›˜
  "patt2": {"ä¸¤é¢": {"ab": 0, "b": 0.02, "c": 0.04, "d": 0.06}}, // Bç›˜
  "patt3": {"ä¸¤é¢": {"ab": 0, "b": 0.03, "c": 0.05, "d": 0.08}}, // Cç›˜
  "patt4": {"ä¸¤é¢": {"ab": 0, "b": 0.05, "c": 0.07, "d": 0.10}}  // Dç›˜
}
```

---

#### **6. å¯¹å†²ï¼ˆHedgingï¼‰**

**å®šä¹‰**ï¼šåœ¨ç¬¬ä¸‰æ–¹å¹³å°ä¸‹åå‘æ³¨å•ï¼Œé”å®šåˆ©æ¶¦æˆ–é™ä½é£é™©ã€‚

**å¯¹å†²åœºæ™¯**ï¼š
```
æœ¬å¹³å°æƒ…å†µï¼š
- ç”¨æˆ·æŠ•æ³¨ 10 ä¸‡å…ƒä¹°"å¤§"ï¼ˆèµ”ç‡ 1.95ï¼‰
- æ½œåœ¨èµ”ä»˜ï¼š19.5 ä¸‡å…ƒ

å¯¹å†²æ“ä½œï¼š
- åˆ°å…¶ä»–å¹³å°æŠ•æ³¨ 10 ä¸‡å…ƒä¹°"å°"ï¼ˆèµ”ç‡ 1.95ï¼‰

ç»“æœåˆ†æï¼š
- å¦‚æœå¼€"å¤§"ï¼šæœ¬å¹³å°èµ” 19.5 ä¸‡ï¼Œå…¶ä»–å¹³å°è¾“ 10 ä¸‡ï¼Œå‡€äº 9.5 ä¸‡
- å¦‚æœå¼€"å°"ï¼šæœ¬å¹³å°èµš 10 ä¸‡ï¼Œå…¶ä»–å¹³å°èµ¢ 19.5 ä¸‡ï¼Œå‡€èµš 9.5 ä¸‡
- æ— è®ºç»“æœå¦‚ä½•ï¼Œåº„å®¶é£é™©è¢«é”å®šåœ¨å¯æ§èŒƒå›´
```

**ä»£ç å®ç°**ï¼ˆ`tools/autobus.php`ï¼‰ï¼š
```php
// æŸ¥è¯¢æœ¬å¹³å°æŠ•æ³¨
$local_bet = SELECT * FROM x_lib WHERE ...;

// æäº¤åˆ°ç¬¬ä¸‰æ–¹å¹³å°
$third_party_api->bet([
    'amount' => $local_bet['je'],
    'type' => 'åå‘',  // å¦‚æœæœ¬åœ°ä¹°å¤§ï¼Œç¬¬ä¸‰æ–¹ä¹°å°
    'odds' => $odds
]);

// è®°å½•å¯¹å†²å•
INSERT INTO x_lib SET flytype=2, xtype=2, ...;
```

---

## ä¸‰ã€æ¾³é—¨å…­åˆå½©å®æˆ˜æ¡ˆä¾‹

### ğŸ² **æ¡ˆä¾‹èƒŒæ™¯**

**æ¸¸æˆä¿¡æ¯**ï¼š
- æ¸¸æˆåç§°ï¼šæ¾³é—¨å…­åˆå½©
- æ¸¸æˆIDï¼ˆgidï¼‰ï¼š300
- å½“å‰æœŸå·ï¼š2025001
- å¼€å¥–æ—¶é—´ï¼šæ¯å¤© 21:30

**ç©æ³•è¯´æ˜**ï¼š
- **ç‰¹ç ä¸¤é¢**ï¼ˆå¤§å°/å•åŒï¼‰
  - ç‰¹ç  â‰¥ 25ï¼šå¤§
  - ç‰¹ç  < 25ï¼šå°
  - ç‰¹ç æ˜¯å¥‡æ•°ï¼šå•
  - ç‰¹ç æ˜¯å¶æ•°ï¼šåŒ
  - èµ”ç‡ï¼š1.95

**æ§ç›˜é…ç½®**ï¼š
| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| è§¦å‘é‡‘é¢ï¼ˆstartjeï¼‰ | 20000 | æŠ•æ³¨é¢è¾¾ 2 ä¸‡å¼€å§‹é™èµ” |
| åˆå§‹é™å¹…ï¼ˆstartpeilvï¼‰ | 0.02 | é¦–æ¬¡é™ä½ 0.02 |
| é€’å¢é‡‘é¢ï¼ˆaddjeï¼‰ | 10000 | æ¯å¢åŠ  1 ä¸‡è§¦å‘ä¸€æ¬¡ |
| é€’å¢é™å¹…ï¼ˆattpeilvï¼‰ | 0.03 | æ¯æ¬¡é™ä½ 0.03 |
| æœ€ä½èµ”ç‡ï¼ˆlowpeilvï¼‰ | 1.75 | ä¸ä½äº 1.75 |
| å°ç›˜é‡‘é¢ï¼ˆstopjeï¼‰ | 200000 | è¾¾åˆ° 20 ä¸‡å°ç›˜ |
| æŒ‰å æˆè®¡ç®—ï¼ˆifzcï¼‰ | 1 | å¯ç”¨ |

---

### ğŸ“Š **å®Œæ•´ä¸šåŠ¡æµç¨‹ï¼ˆ24 å°æ—¶å‘¨æœŸï¼‰**

#### **é˜¶æ®µ 1ï¼šç³»ç»Ÿåˆå§‹åŒ–ï¼ˆå‡Œæ™¨ 00:00ï¼‰**

**1.1 ç”Ÿæˆæ–°æœŸå·**

```sql
-- æŸ¥è¯¢æœ€æ–°æœŸå·
SELECT qishu FROM x_kj WHERE gid=300 ORDER BY qishu DESC LIMIT 1;
-- è¿”å›ï¼š2025000

-- ç”Ÿæˆæ–°æœŸå·
SET @new_qishu = 2025001;

-- æ’å…¥æ–°æœŸå¼€å¥–è®°å½•
INSERT INTO x_kj SET
    gid = 300,
    qishu = '2025001',
    dates = '2025-01-09',
    opentime = '2025-01-09 09:00:00',  -- å¼€ç›˜æ—¶é—´
    closetime = '2025-01-09 21:25:00', -- å°ç›˜æ—¶é—´
    kjtime = '2025-01-09 21:30:00',    -- å¼€å¥–æ—¶é—´
    baostatus = 1,                     -- æŠ¥è¡¨çŠ¶æ€
    m1 = '', m2 = '', m3 = '', m4 = '', m5 = '', m6 = '', m7 = '';  -- å¼€å¥–å·ç ï¼ˆå¾…å¡«å……ï¼‰
```

**1.2 é‡ç½®èµ”ç‡**

```sql
-- æ¢å¤æ‰€æœ‰ç©æ³•åˆ°åŸå§‹èµ”ç‡
UPDATE x_play SET
    peilv1 = mp1,      -- æ¢å¤åŸå§‹èµ”ç‡
    ystart = 0,        -- é‡ç½®é™èµ”æ ‡å¿—
    yautocs = 0,       -- æ¸…é›¶é™èµ”æ¬¡æ•°
    start = 0,
    autocs = 0
WHERE gid = 300;

-- éªŒè¯é‡ç½®ç»“æœ
SELECT pid, name, peilv1, mp1 FROM x_play WHERE gid=300 LIMIT 5;
```

**æ‰§è¡Œç»“æœ**ï¼š
```
+----------+----------+--------+-------+
| pid      | name     | peilv1 | mp1   |
+----------+----------+--------+-------+
| 30000001 | ç‰¹ç å¤§   | 1.9500 | 1.9500|
| 30000002 | ç‰¹ç å°   | 1.9500 | 1.9500|
| 30000003 | ç‰¹ç å•   | 1.9500 | 1.9500|
| 30000004 | ç‰¹ç åŒ   | 1.9500 | 1.9500|
+----------+----------+--------+-------+
```

---

#### **é˜¶æ®µ 2ï¼šå¼€ç›˜æ¥å—æŠ•æ³¨ï¼ˆ09:00-21:25ï¼‰**

**2.1 ç”¨æˆ·å¼€å§‹æŠ•æ³¨**

**åœºæ™¯**ï¼š10 ä½ç”¨æˆ·é™†ç»­æŠ•æ³¨"ç‰¹ç å¤§"

```sql
-- ç”¨æˆ·1ï¼š10001ï¼ŒæŠ•æ³¨ 5000 å…ƒ
INSERT INTO x_lib SET
    gid = 300,
    qishu = '2025001',
    tid = '10000001',                    -- è®¢å•ID
    userid = 10001,                      -- ç”¨æˆ·ID
    dates = '2025-01-09',
    time = '2025-01-09 10:15:32',
    pid = 30000001,                      -- ç©æ³•IDï¼ˆç‰¹ç å¤§ï¼‰
    content = '',                        -- ä¸¤é¢ç©æ³•æ— å…·ä½“å†…å®¹
    je = 5000.00,                        -- æŠ•æ³¨é‡‘é¢
    peilv1 = 1.95,                       -- å½“å‰èµ”ç‡
    zc0 = 80,                            -- ç³»ç»Ÿå æˆ 80%
    zc1 = 20,                            -- ä¸€çº§ä»£ç†å æˆ 20%
    xtype = 1,                           -- æ³¨å•ç±»å‹ï¼ˆ1=ç”¨æˆ·æŠ•æ³¨ï¼‰
    flytype = 0,                         -- é£å•ç±»å‹ï¼ˆ0=æ— é£å•ï¼‰
    z = 0,                               -- ä¸­å¥–çŠ¶æ€ï¼ˆ0=æœªå¼€å¥–ï¼‰
    prize = 0.00,                        -- ä¸­å¥–é‡‘é¢
    ip = INET_ATON('192.168.1.100');

-- ç”¨æˆ·2ï¼š10002ï¼ŒæŠ•æ³¨ 3000 å…ƒ
INSERT INTO x_lib SET
    gid = 300, qishu = '2025001', tid = '10000002',
    userid = 10002, dates = '2025-01-09', time = '2025-01-09 11:20:15',
    pid = 30000001, content = '', je = 3000.00, peilv1 = 1.95,
    zc0 = 80, zc1 = 20, xtype = 1, flytype = 0, z = 0, prize = 0.00,
    ip = INET_ATON('192.168.1.101');

-- ...ä¾æ¬¡æ’å…¥å…¶ä»–ç”¨æˆ·æŠ•æ³¨ï¼ˆçœç•¥ï¼‰
```

---

**2.2 å®šæ—¶ä»»åŠ¡ç»Ÿè®¡æŠ•æ³¨é¢ï¼ˆæ¯æ¬¡å¼€ç›˜æ—¶æ‰§è¡Œï¼‰**

```bash
# crontab å®šæ—¶ä»»åŠ¡ï¼ˆæ¯ 1 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰
* * * * * php /path/to/tools/autos_ss.php
```

**æ‰§è¡Œä»£ç **ï¼ˆ`tools/autos_ss.php:274`ï¼‰ï¼š
```php
// è°ƒç”¨é™èµ”å‡½æ•°
attpeilvs(300);  // 300 = æ¾³é—¨å…­åˆå½©
```

**é™èµ”å‡½æ•°æ ¸å¿ƒé€»è¾‘**ï¼ˆ`func/adminfunc.php:620`ï¼‰ï¼š
```php
function attpeilvs($gid) {
    global $psql, $tb_auto, $tb_lib, $tb_play, $tb_peilv;

    // 1. æŸ¥è¯¢å½“å‰æœŸå·
    $psql->query("SELECT thisqishu FROM x_game WHERE gid='300'");
    $psql->next_record();
    $qishu = $psql->f('thisqishu');  // è¿”å›ï¼š2025001

    // 2. æŸ¥è¯¢æ§ç›˜é…ç½®
    $sql = "SELECT * FROM x_auto
            WHERE gid='300' AND ifok=1 AND userid='99999999' AND class='ä¸¤é¢'";
    $psql->query($sql);
    $psql->next_record();

    $startje = $psql->f('startje');      // 20000
    $startpeilv = $psql->f('startpeilv'); // 0.02
    $addje = $psql->f('addje');           // 10000
    $attpeilv = $psql->f('attpeilv');     // 0.03
    $lowpeilv = $psql->f('lowpeilv');     // 1.75
    $ifzc = $psql->f('ifzc');             // 1

    // 3. ç»Ÿè®¡"ç‰¹ç å¤§"çš„æŠ•æ³¨é¢ï¼ˆæŒ‰å æˆè®¡ç®—ï¼‰
    $sql = "SELECT SUM(je * zc0 / 100) AS total_je, pid
            FROM x_lib
            WHERE gid='300' AND qishu='2025001'
            AND xtype != 2          -- æ’é™¤å¯¹å†²å•
            AND zc0 > 0             -- æœ‰å æˆ
            AND pid = '30000001'    -- ç‰¹ç å¤§
            GROUP BY pid";
    $psql->query($sql);
    $psql->next_record();

    $total_je = $psql->f('total_je');  // å‡è®¾è¿”å›ï¼š28000
    $pid = $psql->f('pid');            // 30000001

    // 4. åˆ¤æ–­æ˜¯å¦è§¦å‘é™èµ”
    if ($total_je >= $startje) {  // 28000 >= 20000ï¼Œè§¦å‘ï¼

        // 5. æŸ¥è¯¢å½“å‰é™èµ”çŠ¶æ€
        $psql->query("SELECT ystart, yautocs, peilv1 FROM x_play
                      WHERE gid='300' AND pid='30000001'");
        $psql->next_record();
        $ystart = $psql->f('ystart');    // 0ï¼ˆæœªå¼€å§‹é™èµ”ï¼‰
        $yautocs = $psql->f('yautocs');  // 0
        $old_peilv = $psql->f('peilv1'); // 1.95

        if ($ystart == 0) {
            // é¦–æ¬¡è§¦å‘ï¼šé™ä½åˆå§‹å¹…åº¦
            $new_peilv = $old_peilv - $startpeilv;  // 1.95 - 0.02 = 1.93

            $psql->query("UPDATE x_play SET
                          ystart = 1,
                          yautocs = 1,
                          peilv1 = $new_peilv
                          WHERE gid='300' AND pid='30000001'");

            // è®°å½•æ—¥å¿—
            $psql->query("INSERT INTO x_peilv SET
                          gid='300', pid='30000001',
                          peilv='-0.02',
                          time=NOW(), userid='99999999', auto=1");

            echo "é¦–æ¬¡é™èµ”ï¼šç‰¹ç å¤§ 1.95 â†’ 1.93\n";
        } else {
            // åç»­è§¦å‘ï¼šæŒ‰å…¬å¼è®¡ç®—
            $attcs = floor(($total_je - $startje) / $addje) + 1;
            // attcs = floor((28000 - 20000) / 10000) + 1 = 1 + 1 = 2

            $ucs = $attcs - $yautocs;  // 2 - 1 = 1ï¼ˆéœ€è¦é™1æ¬¡ï¼‰

            if ($ucs > 0) {
                $reduce = $ucs * $attpeilv;  // 1 Ã— 0.03 = 0.03
                $new_peilv = $old_peilv - $reduce;  // 1.93 - 0.03 = 1.90
                $new_peilv = max($new_peilv, $lowpeilv);  // max(1.90, 1.75) = 1.90

                $psql->query("UPDATE x_play SET
                              yautocs = $attcs,
                              peilv1 = $new_peilv
                              WHERE gid='300' AND pid='30000001'");

                $psql->query("INSERT INTO x_peilv SET
                              gid='300', pid='30000001',
                              peilv='-0.03',
                              time=NOW(), userid='99999999', auto=1");

                echo "ç¬¬{$ucs}æ¬¡é™èµ”ï¼šç‰¹ç å¤§ 1.93 â†’ 1.90\n";
            }
        }
    }
}
```

**æ‰§è¡Œç»“æœ**ï¼š
```sql
-- æŸ¥è¯¢é™èµ”åçš„èµ”ç‡
SELECT pid, name, peilv1, ystart, yautocs FROM x_play WHERE gid=300 AND pid=30000001;
```

```
+----------+--------+--------+--------+---------+
| pid      | name   | peilv1 | ystart | yautocs |
+----------+--------+--------+--------+---------+
| 30000001 | ç‰¹ç å¤§ | 1.9000 | 1      | 2       |
+----------+--------+--------+--------+---------+
```

---

**2.3 é£å•æœºåˆ¶è‡ªåŠ¨æ‰§è¡Œï¼ˆæ¯ 10 ç§’ï¼‰**

**è§¦å‘æ—¶æœº**ï¼š`tools/cj_kj.php` æ¯ 10 ç§’è°ƒç”¨ `autoflys_ss.php`

**é£å•é…ç½®**ï¼ˆx_fly è¡¨ï¼‰ï¼š
```sql
SELECT * FROM x_fly WHERE gid=300 AND userid=99999999 AND class='ä¸¤é¢';
```

```
+----+-----+-----------+-------+----+----------+----------+------+
| id | gid | userid    | class | ab | je       | maxje    | ifok |
+----+-----+-----------+-------+----+----------+----------+------+
| 5  | 300 | 99999999  | ä¸¤é¢  | A  | 10000.00 | 20000.00 | 1    |
+----+-----+-----------+-------+----+----------+----------+------+
```

è§£è¯»ï¼š
- é£å•é˜ˆå€¼ï¼ˆjeï¼‰ï¼š10000 å…ƒ
- å•æ¬¡æœ€å¤§é£å•é‡‘é¢ï¼ˆmaxjeï¼‰ï¼š20000 å…ƒ
- å¯ç”¨çŠ¶æ€ï¼ˆifokï¼‰ï¼š1

**é£å•è®¡ç®—é€»è¾‘**ï¼š
```php
// 1. ç»Ÿè®¡ç³»ç»Ÿå æˆæ€»é¢
$sql = "SELECT SUM(je * zc0 / 100) AS zcje
        FROM x_lib
        WHERE gid='300' AND qishu='2025001'
        AND pid='30000001'  -- ç‰¹ç å¤§
        AND xtype != 2      -- æ’é™¤å¯¹å†²å•
        AND zc0 > 0";
$psql->query($sql);
$psql->next_record();
$zcje = $psql->f('zcje');  // å‡è®¾ï¼š28000 Ã— 80% = 22400

// 2. ç»Ÿè®¡å·²é£å•é‡‘é¢
$sql = "SELECT SUM(je) AS yfje
        FROM x_lib
        WHERE gid='300' AND qishu='2025001'
        AND pid='30000001'
        AND userid='99999999'  -- ç³»ç»Ÿè´¦æˆ·
        AND flytype=1          -- é£å•æ ‡è¯†
        AND xtype=1";
$psql->query($sql);
$psql->next_record();
$yfje = $psql->f('yfje');  // å‡è®¾ï¼š5000ï¼ˆä¹‹å‰å·²é£ï¼‰

// 3. è®¡ç®—åº”é£å•é‡‘é¢
$limitje = 10000;  // é£å•é˜ˆå€¼
$maxje = 20000;    // å•æ¬¡æœ€å¤§
$je = floor($zcje - $limitje - $yfje);
// je = floor(22400 - 10000 - 5000) = 7400

if ($je >= 1) {
    if ($je > $maxje) {
        $je = $maxje;  // ä¸è¶…è¿‡å•æ¬¡æœ€å¤§
    }

    // 4. æ’å…¥é£å•è®°å½•
    $sql = "INSERT INTO x_lib SET
            gid='300', qishu='2025001',
            tid='90000001',
            userid='99999999',  -- ç³»ç»Ÿè´¦æˆ·
            dates='2025-01-09',
            time=NOW(),
            pid='30000001',
            content='',
            je=$je,
            peilv1=1.90,        -- ä½¿ç”¨é™èµ”åçš„èµ”ç‡
            zc0=100,            -- ç³»ç»Ÿå æˆ100%
            xtype=1,            -- æ­£å¸¸æŠ•æ³¨ç±»å‹
            flytype=1,          -- æ ‡è®°ä¸ºé£å•
            z=0,
            prize=0.00,
            ip=INET_ATON('127.0.0.1')";
    $psql->query($sql);

    echo "é£å•æˆåŠŸï¼šé‡‘é¢ 7400 å…ƒ\n";
}
```

**æŸ¥è¯¢é£å•è®°å½•**ï¼š
```sql
SELECT tid, userid, je, flytype, time
FROM x_lib
WHERE gid=300 AND qishu='2025001' AND flytype=1
ORDER BY time DESC;
```

```
+-----------+-----------+---------+---------+---------------------+
| tid       | userid    | je      | flytype | time                |
+-----------+-----------+---------+---------+---------------------+
| 90000001  | 99999999  | 7400.00 | 1       | 2025-01-09 15:30:12 |
| 90000002  | 99999999  | 5000.00 | 1       | 2025-01-09 12:10:05 |
+-----------+-----------+---------+---------+---------------------+
```

---

#### **é˜¶æ®µ 3ï¼šå°ç›˜ä¸å¼€å¥–ï¼ˆ21:25-21:30ï¼‰**

**3.1 è‡ªåŠ¨å°ç›˜**

```php
// tools/autos_ss.php å®šæ—¶æ£€æŸ¥
$time = time();
$fsql->query("SELECT closetime FROM x_kj WHERE gid='300' AND qishu='2025001'");
$fsql->next_record();
$closetime = strtotime($fsql->f('closetime'));  // 21:25:00

if ($time >= $closetime) {
    // å…³é—­ç›˜å£
    $psql->query("UPDATE x_game SET panstatus=0 WHERE gid='300'");
    echo "æ¾³é—¨å…­åˆå½©å·²å°ç›˜\n";
}
```

**3.2 é‡‡é›†å¼€å¥–æ•°æ®**

```php
// tools/autokjs_ss.php é‡‡é›†å¼€å¥–
$url = 'http://api.bjjfnet.com/data/opencode/2032';  // æ¾³é—¨å…­åˆå½©API
$ma = http_get($url);
$ma = json_decode($ma, true);

// è§£æå¼€å¥–å·ç 
$m = explode(',', $ma['data'][0]['openCode']);
// å‡è®¾å¼€å¥–ï¼š[01, 12, 23, 34, 45, 49, 28]

$qishu = $ma['data'][0]['issue'];  // 2025001

// æ›´æ–°æ•°æ®åº“
$sql = "UPDATE x_kj SET
        m1='01', m2='12', m3='23', m4='34', m5='45', m6='49', m7='28'
        WHERE gid='300' AND qishu='2025001'";
$psql->query($sql);

echo "å¼€å¥–æˆåŠŸï¼šæœŸå· 2025001ï¼Œå·ç  01,12,23,34,45,49,28\n";
```

**3.3 è®¡ç®—ä¸­å¥–**

```php
// ç‰¹ç  = 28ï¼Œåˆ¤æ–­å¤§å°å•åŒ
$tm = 28;
$result = [];
$result['å¤§å°'] = ($tm >= 25) ? 'å¤§' : 'å°';  // 28 >= 25ï¼Œç»“æœï¼šå¤§
$result['å•åŒ'] = ($tm % 2 == 0) ? 'åŒ' : 'å•';  // 28 % 2 = 0ï¼Œç»“æœï¼šåŒ

echo "ç‰¹ç ï¼š28ï¼Œå¤§ï¼ŒåŒ\n";

// æ›´æ–°ä¸­å¥–çŠ¶æ€
$sql = "UPDATE x_lib SET
        z = 1,                              -- ä¸­å¥–
        prize = je * peilv1                 -- è®¡ç®—å¥–é‡‘
        WHERE gid='300' AND qishu='2025001'
        AND pid IN (30000001, 30000004)";   -- ç‰¹ç å¤§ã€ç‰¹ç åŒ
// ç‰¹ç å¤§ pid=30000001ï¼Œç‰¹ç åŒ pid=30000004

$psql->query($sql);

// æ ‡è®°æœªä¸­å¥–
$sql = "UPDATE x_lib SET z = 7              -- æœªä¸­å¥–
        WHERE gid='300' AND qishu='2025001'
        AND pid IN (30000002, 30000003)";   -- ç‰¹ç å°ã€ç‰¹ç å•
$psql->query($sql);

// æ ‡è®°ç»“ç®—å®Œæˆ
$sql = "UPDATE x_kj SET js=1 WHERE gid='300' AND qishu='2025001'";
$psql->query($sql);
```

**æŸ¥è¯¢ä¸­å¥–è®°å½•**ï¼š
```sql
SELECT userid, je, peilv1, prize, z
FROM x_lib
WHERE gid=300 AND qishu='2025001' AND pid=30000001
ORDER BY userid;
```

```
+---------+---------+--------+-----------+---+
| userid  | je      | peilv1 | prize     | z |
+---------+---------+--------+-----------+---+
| 10001   | 5000.00 | 1.9500 | 9750.00   | 1 | â† åŸå§‹æŠ•æ³¨ï¼Œèµ”ç‡1.95
| 10002   | 3000.00 | 1.9500 | 5850.00   | 1 |
| 10003   | 8000.00 | 1.9000 | 15200.00  | 1 | â† é™èµ”åæŠ•æ³¨ï¼Œèµ”ç‡1.90
| 10004   | 6000.00 | 1.9000 | 11400.00  | 1 |
| 99999999| 7400.00 | 1.9000 | 14060.00  | 1 | â† ç³»ç»Ÿé£å•
+---------+---------+--------+-----------+---+
```

---

#### **é˜¶æ®µ 4ï¼šç»“ç®—ä¸é‡ç½®ï¼ˆ21:30-23:59ï¼‰**

**4.1 ç”¨æˆ·ä½™é¢ç»“ç®—**

```sql
-- ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è¾“èµ¢
SELECT
    userid,
    SUM(CASE WHEN z=1 THEN prize - je ELSE -je END) AS profit
FROM x_lib
WHERE gid=300 AND qishu='2025001' AND xtype=1
GROUP BY userid;
```

```
+---------+----------+
| userid  | profit   |
+---------+----------+
| 10001   | 4750.00  | â† æŠ•æ³¨5000ï¼Œä¸­å¥–9750ï¼Œç›ˆåˆ©4750
| 10002   | 2850.00  |
| 10003   | 7200.00  |
| 10004   | 5400.00  |
| 10005   | -2000.00 | â† æœªä¸­å¥–ï¼ŒäºæŸ2000
| 99999999| 6660.00  | â† ç³»ç»Ÿé£å•ç›ˆåˆ©
+---------+----------+
```

**4.2 æ›´æ–°ç”¨æˆ·ä½™é¢**

```sql
-- ç»™ä¸­å¥–ç”¨æˆ·åŠ é’±
UPDATE x_user u
SET u.balance = u.balance + (
    SELECT SUM(prize)
    FROM x_lib
    WHERE userid = u.userid AND gid=300 AND qishu='2025001' AND z=1
)
WHERE userid IN (SELECT userid FROM x_lib WHERE gid=300 AND qishu='2025001' AND z=1);
```

**4.3 é‡ç½®èµ”ç‡ï¼ˆå¼€å¥–åç«‹å³æ‰§è¡Œï¼‰**

```php
// func/adminfunc.php:737 - attpeilv() å‡½æ•°
function attpeilv($gid) {
    global $psql, $tb_play;

    // æ¢å¤æ‰€æœ‰ç©æ³•åˆ°åŸå§‹èµ”ç‡
    $psql->query("UPDATE x_play SET
                  peilv1 = mp1,
                  ystart = 0,
                  yautocs = 0,
                  start = 0,
                  autocs = 0
                  WHERE gid='300'");

    echo "æ¾³é—¨å…­åˆå½©èµ”ç‡å·²é‡ç½®\n";
}

// è°ƒç”¨æ—¶æœºï¼štools/autokjs_ss.php å¼€å¥–å
if ($autoresetpl == 1) {
    $psql->query("UPDATE x_play SET peilv1=mp1 WHERE gid='300'");
}
```

**éªŒè¯é‡ç½®**ï¼š
```sql
SELECT pid, name, peilv1, ystart, yautocs FROM x_play WHERE gid=300 LIMIT 4;
```

```
+----------+--------+--------+--------+---------+
| pid      | name   | peilv1 | ystart | yautocs |
+----------+--------+--------+--------+---------+
| 30000001 | ç‰¹ç å¤§ | 1.9500 | 0      | 0       |
| 30000002 | ç‰¹ç å° | 1.9500 | 0      | 0       |
| 30000003 | ç‰¹ç å• | 1.9500 | 0      | 0       |
| 30000004 | ç‰¹ç åŒ | 1.9500 | 0      | 0       |
+----------+--------+--------+--------+---------+
```

---

### ğŸ“ˆ **æ•°æ®ç»Ÿè®¡ä¸åˆ†æ**

#### **1. æœ¬æœŸæ€»æŠ•æ³¨é¢**

```sql
SELECT
    SUM(je) AS total_bet,
    SUM(CASE WHEN z=1 THEN prize ELSE 0 END) AS total_prize,
    SUM(CASE WHEN z=1 THEN prize - je ELSE -je END) AS profit
FROM x_lib
WHERE gid=300 AND qishu='2025001' AND xtype=1;
```

```
+------------+-------------+---------+
| total_bet  | total_prize | profit  |
+------------+-------------+---------+
| 50000.00   | 68500.00    | 18500.00|
+------------+-------------+---------+
```

è§£è¯»ï¼š
- æ€»æŠ•æ³¨é¢ï¼š50000 å…ƒ
- æ€»èµ”ä»˜ï¼š68500 å…ƒ
- åº„å®¶äºæŸï¼š18500 å…ƒ

---

#### **2. é™èµ”å†å²è®°å½•**

```sql
SELECT
    time AS 'æ—¶é—´',
    peilv AS 'èµ”ç‡å˜åŒ–',
    CASE auto
        WHEN 1 THEN 'è‡ªåŠ¨'
        ELSE 'æ‰‹åŠ¨'
    END AS 'æ–¹å¼'
FROM x_peilv
WHERE gid=300 AND qishu='2025001'
ORDER BY time;
```

```
+---------------------+----------+------+
| æ—¶é—´                | èµ”ç‡å˜åŒ– | æ–¹å¼ |
+---------------------+----------+------+
| 2025-01-09 10:30:15 | -0.02    | è‡ªåŠ¨ | â† é¦–æ¬¡é™èµ”
| 2025-01-09 14:20:42 | -0.03    | è‡ªåŠ¨ | â† ç¬¬2æ¬¡é™èµ”
+---------------------+----------+------+
```

---

#### **3. é£å•æ±‡æ€»**

```sql
SELECT
    COUNT(*) AS fly_count,
    SUM(je) AS total_fly,
    SUM(CASE WHEN z=1 THEN prize - je ELSE -je END) AS fly_profit
FROM x_lib
WHERE gid=300 AND qishu='2025001' AND flytype=1;
```

```
+-----------+-----------+------------+
| fly_count | total_fly | fly_profit |
+-----------+-----------+------------+
| 2         | 12400.00  | 8960.00    |
+-----------+-----------+------------+
```

è§£è¯»ï¼š
- é£å•æ¬¡æ•°ï¼š2 æ¬¡
- é£å•æ€»é¢ï¼š12400 å…ƒ
- é£å•ç›ˆåˆ©ï¼š8960 å…ƒï¼ˆå¸®ç³»ç»Ÿæ‰¿æ‹…äº†å¤§éƒ¨åˆ†èµ”ä»˜ï¼‰

---

### ğŸ”„ **å®Œæ•´ SQL æ‰§è¡Œåºåˆ—ï¼ˆæ—¶é—´çº¿ï¼‰**

```sql
-- ========== 00:00 ç³»ç»Ÿåˆå§‹åŒ– ==========
-- 1. ç”Ÿæˆæ–°æœŸå·
INSERT INTO x_kj (gid, qishu, dates, opentime, closetime, kjtime, baostatus)
VALUES (300, '2025001', '2025-01-09', '2025-01-09 09:00:00', '2025-01-09 21:25:00', '2025-01-09 21:30:00', 1);

-- 2. é‡ç½®èµ”ç‡
UPDATE x_play SET peilv1=mp1, ystart=0, yautocs=0 WHERE gid=300;

-- ========== 09:00-21:25 æ¥å—æŠ•æ³¨ ==========
-- 3. ç”¨æˆ·æŠ•æ³¨ï¼ˆç¤ºä¾‹ï¼‰
INSERT INTO x_lib (gid, qishu, userid, pid, je, peilv1, zc0, xtype, flytype)
VALUES (300, '2025001', 10001, 30000001, 5000, 1.95, 80, 1, 0);

-- 4. å®šæ—¶ç»Ÿè®¡æŠ•æ³¨é¢
SELECT SUM(je * zc0 / 100) AS total FROM x_lib
WHERE gid=300 AND qishu='2025001' AND pid=30000001 AND xtype!=2;

-- 5. è§¦å‘é™èµ”ï¼ˆæŠ•æ³¨é¢ >= 20000ï¼‰
UPDATE x_play SET ystart=1, yautocs=1, peilv1=peilv1-0.02
WHERE gid=300 AND pid=30000001;

INSERT INTO x_peilv (gid, pid, peilv, time, userid, auto)
VALUES (300, 30000001, -0.02, NOW(), 99999999, 1);

-- 6. é£å•ï¼ˆæ¯10ç§’æ£€æŸ¥ï¼‰
INSERT INTO x_lib (gid, qishu, userid, pid, je, peilv1, zc0, xtype, flytype)
VALUES (300, '2025001', 99999999, 30000001, 7400, 1.90, 100, 1, 1);

-- ========== 21:25 å°ç›˜ ==========
-- 7. å…³é—­ç›˜å£
UPDATE x_game SET panstatus=0 WHERE gid=300;

-- ========== 21:30 å¼€å¥– ==========
-- 8. é‡‡é›†å¼€å¥–å·ç 
UPDATE x_kj SET m1='01', m2='12', m3='23', m4='34', m5='45', m6='49', m7='28'
WHERE gid=300 AND qishu='2025001';

-- 9. è®¡ç®—ä¸­å¥–ï¼ˆç‰¹ç =28ï¼Œå¤§ï¼ŒåŒï¼‰
UPDATE x_lib SET z=1, prize=je*peilv1
WHERE gid=300 AND qishu='2025001' AND pid IN (30000001, 30000004);

UPDATE x_lib SET z=7
WHERE gid=300 AND qishu='2025001' AND pid IN (30000002, 30000003);

-- 10. æ ‡è®°ç»“ç®—å®Œæˆ
UPDATE x_kj SET js=1 WHERE gid=300 AND qishu='2025001';

-- 11. é‡ç½®èµ”ç‡
UPDATE x_play SET peilv1=mp1, ystart=0, yautocs=0 WHERE gid=300;

-- ========== éªŒè¯æŸ¥è¯¢ ==========
-- 12. æŸ¥è¯¢ä¸­å¥–è®°å½•
SELECT userid, je, peilv1, prize, z
FROM x_lib
WHERE gid=300 AND qishu='2025001' AND pid=30000001;

-- 13. æŸ¥è¯¢é™èµ”å†å²
SELECT time, peilv FROM x_peilv
WHERE gid=300 AND qishu='2025001'
ORDER BY time;

-- 14. æŸ¥è¯¢é£å•è®°å½•
SELECT userid, je, flytype FROM x_lib
WHERE gid=300 AND qishu='2025001' AND flytype=1;
```

---

### ğŸ’¡ **å…³é”®æ•°æ®æµè½¬å›¾**

```
ç”¨æˆ·æŠ•æ³¨
    â†“
x_lib è¡¨ï¼ˆåŸå§‹æŠ•æ³¨ï¼‰
    â†“
å®šæ—¶ä»»åŠ¡ç»Ÿè®¡ï¼ˆæ¯åˆ†é’Ÿï¼‰
    â†“
x_auto é…ç½®è¡¨ï¼ˆæ£€æŸ¥è§¦å‘æ¡ä»¶ï¼‰
    â†“
è¾¾åˆ°é˜ˆå€¼ï¼Ÿ
    â”œâ”€â†’ æ˜¯ï¼šæ‰§è¡Œé™èµ”
    â”‚       â†“
    â”‚   x_play è¡¨ï¼ˆæ›´æ–°èµ”ç‡ï¼‰
    â”‚       â†“
    â”‚   x_peilv è¡¨ï¼ˆè®°å½•æ—¥å¿—ï¼‰
    â”‚
    â””â”€â†’ å¦ï¼šè·³è¿‡

é£å•å®šæ—¶ä»»åŠ¡ï¼ˆæ¯10ç§’ï¼‰
    â†“
x_fly é…ç½®è¡¨ï¼ˆæ£€æŸ¥é˜ˆå€¼ï¼‰
    â†“
è¶…è¿‡é˜ˆå€¼ï¼Ÿ
    â”œâ”€â†’ æ˜¯ï¼šæ‰§è¡Œé£å•
    â”‚       â†“
    â”‚   x_lib è¡¨ï¼ˆæ’å…¥ç³»ç»Ÿæ³¨å•ï¼‰
    â”‚
    â””â”€â†’ å¦ï¼šè·³è¿‡

å¼€å¥–æ—¶é—´åˆ°
    â†“
é‡‡é›†APIæ•°æ®
    â†“
x_kj è¡¨ï¼ˆå†™å…¥å¼€å¥–å·ç ï¼‰
    â†“
è®¡ç®—ä¸­å¥–
    â†“
x_lib è¡¨ï¼ˆæ›´æ–°z, prizeå­—æ®µï¼‰
    â†“
é‡ç½®èµ”ç‡
    â†“
x_play è¡¨ï¼ˆæ¢å¤åŸå§‹èµ”ç‡ï¼‰
```

---

## å››ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

## äºŒã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

ç³»ç»ŸåŒ…å« **3 å¤§æ§ç›˜æœºåˆ¶**ï¼š

### âœ… **1. è‡ªåŠ¨é™èµ”ï¼ˆAuto Adjust Oddsï¼‰**

**è§¦å‘æ—¶æœº**ï¼šæ¯æ¬¡å¼€ç›˜æ—¶è‡ªåŠ¨æ‰§è¡Œï¼ˆ`tools/autos_ss.php:100`ã€`274` è°ƒç”¨ `attpeilvs($gid)`ï¼‰

**æ ¸å¿ƒé€»è¾‘**ï¼ˆ`func/adminfunc.php:620-736`ï¼‰ï¼š

```php
function attpeilvs($gid) {
    // 1. è·å–å½“å‰æœŸå·
    $psql->query("select thisqishu from `$tb_game` where gid='$gid'");
    $psql->next_record();
    $qishu = $psql->f('thisqishu');

    // 2. æŸ¥è¯¢æ§ç›˜é…ç½®ï¼ˆx_auto è¡¨ï¼‰
    $sql = "select * from `$tb_auto` where gid='$gid' and ifok=1
            and (userid='99999999' or userid in
            (select userid from `$tb_user` where layer=1 and ifexe=1 and pself=1))";
    $rs = $psql->arr($sql, 1);

    // 3. éå†æ¯ä¸ªç©æ³•ï¼ˆå¦‚"ä¸¤é¢"ã€"ç‰¹ç "ç­‰ï¼‰
    foreach ($rs as $config) {
        $startje = $config['startje'];      // è§¦å‘é‡‘é¢ï¼ˆå¦‚ 1000ï¼‰
        $startpeilv = $config['startpeilv']; // åˆå§‹é™ä½å¹…åº¦ï¼ˆå¦‚ 0.01ï¼‰
        $addje = $config['addje'];           // æ¯å¢åŠ é‡‘é¢ï¼ˆå¦‚ 500ï¼‰
        $attpeilv = $config['attpeilv'];     // æ¯æ¬¡é™ä½å¹…åº¦ï¼ˆå¦‚ 0.02ï¼‰
        $lowpeilv = $config['lowpeilv'];     // æœ€ä½èµ”ç‡ï¼ˆå¦‚ 1.80ï¼‰
        $class = $config['class'];           // ç©æ³•ç±»å‹

        // 4. ç»Ÿè®¡è¯¥ç©æ³•çš„æŠ•æ³¨é¢
        if ($ifzc == 1) {
            $pa = $psql->arr("select sum(je*zc0/100) as je,pid,content
                              from `$tb_lib`
                              where gid='$gid' and qishu='$qishu'
                              and xtype!=2 and cid in ($tmp)
                              and content=''
                              group by pid", 1);
        } else {
            $pa = $psql->arr("select sum(je) as je,pid,content
                              from `$tb_lib`
                              where gid='$gid' and qishu='$qishu'
                              and xtype!=2 and cid in ($tmp)
                              and content=''
                              group by pid", 1);
        }

        // 5. è®¡ç®—é™èµ”æ¬¡æ•°
        foreach ($pa as $bet) {
            $je = $bet['je'];
            if ($je < $startje) {
                continue; // æœªè¾¾åˆ°è§¦å‘é‡‘é¢
            }

            // æ£€æŸ¥æ˜¯å¦å·²å¼€å§‹é™èµ”
            $psql->query("select yautocs,ystart from `$tb_play`
                          where gid='$gid' and pid='$pid'");
            $psql->next_record();
            $ystart = $psql->f('ystart');
            $yautocs = $psql->f('yautocs');

            if ($ystart == 0) {
                // é¦–æ¬¡è§¦å‘ï¼šé™ä½åˆå§‹å¹…åº¦
                $psql->query("update `$tb_play`
                              set ystart=1, yautocs=1,
                              peilv1=peilv1-$startpeilv
                              where gid='$gid' and pid='$pid'");
                $startpeilvs = 0 - $startpeilv;
                $psql->query("insert into `$tb_peilv`
                              set gid='$gid', pid='$pid',
                              peilv='$startpeilvs', time=NOW(),
                              userid='$userid', sonuser='11111111', auto=1");
            } else {
                // åç»­è§¦å‘ï¼šæŒ‰å…¬å¼è®¡ç®—é™èµ”æ¬¡æ•°
                $attcs = ((($je - $startje) - (($je - $startje) % $addje)) / $addje) + 1;
                $ucs = floor($attcs - $yautocs);

                if ($ucs > 0) {
                    // 6. æ›´æ–°èµ”ç‡ï¼ˆä¸ä½äºæœ€ä½èµ”ç‡ï¼‰
                    $psql->query("update `$tb_play`
                                  set yautocs='$attcs',
                                  peilv1=if(peilv1-$ucs*$attpeilv>$lowpeilv,
                                           peilv1-$ucs*$attpeilv,
                                           $lowpeilv)
                                  where gid='$gid' and pid='$pid'");

                    // 7. è®°å½•èµ”ç‡å˜æ›´æ—¥å¿—
                    $tmp = 0 - $ucs * $attpeilv;
                    $psql->query("insert into `$tb_peilv`
                                  set gid='$gid', pid='$pid',
                                  peilv='$tmp', time=NOW(),
                                  userid='$userid', sonuser='11111111', auto=1");
                }
            }

            // è¾¾åˆ°å°ç›˜é‡‘é¢
            if ($je >= $stopje) {
                // å¯é€‰ï¼šå…³é—­è¯¥ç©æ³•
                // $psql->query("update `$tb_play` set ifok='0'
                //               where gid='$gid' and pid='$pid'");
            }
        }
    }
}
```

**é™èµ”è®¡ç®—å…¬å¼**ï¼š

```
é™èµ”æ¬¡æ•° = floor((å½“å‰æŠ•æ³¨é¢ - è§¦å‘é‡‘é¢) / é€’å¢é‡‘é¢) + 1
å½“å‰èµ”ç‡ = åŸå§‹èµ”ç‡ - åˆå§‹é™å¹… - (é™èµ”æ¬¡æ•° - 1) Ã— æ¯æ¬¡é™å¹…
å½“å‰èµ”ç‡ = MAX(å½“å‰èµ”ç‡, æœ€ä½èµ”ç‡)
```

---

### âœ… **2. è‡ªåŠ¨è¡¥è´§/é£å•ï¼ˆAuto Flyï¼‰**

**è§¦å‘æ—¶æœº**ï¼šæ¯ 10 ç§’æ‰§è¡Œï¼ˆ`tools/autoflys_ss.php`ï¼Œé€šè¿‡ `cj_kj.php` è°ƒåº¦ï¼‰

**æ ¸å¿ƒé€»è¾‘**ï¼ˆ`tools/autoflys_ss.php:238-378`ï¼‰ï¼š

```php
// 1. æŸ¥è¯¢ä¸‹çº§æŠ•æ³¨ï¼ˆæŒ‰ç©æ³•ã€å†…å®¹åˆ†ç»„ï¼‰
$list = $msql->arr("select bid,sid,cid,pid,content,bz,ab
                    from `$tb_lib`
                    where gid='$gid' and qishu='$qishu'
                    and uid{$layer}='{$userid}'
                    and xtype!=2 and zc{$layer}>0
                    group by cid,pid,content", 1);

// 2. éå†æ¯ä¸ªæŠ•æ³¨é¡¹
foreach ($list as $bet) {
    $pid = $bet['pid'];
    $content = $bet['content'];

    // 3. æŸ¥è¯¢è¯¥ç©æ³•çš„é£å•é™é¢
    $fsql->query("select je,ifok,maxje from `$tb_fly`
                  where gid='$gid' and userid='$userid'
                  and class='$ftype' and ab='A'");
    $fsql->next_record();
    $limitje = $fsql->f('je');  // é£å•é˜ˆå€¼
    $maxje = $fsql->f('maxje'); // å•æ¬¡æœ€å¤§é£å•é‡‘é¢

    // 4. ç»Ÿè®¡è¯¥ç©æ³•çš„æ€»å æˆ
    $tsql->query("select sum(je*zc{$layer}/100)
                  from `$tb_lib`
                  where gid='$gid' and uid{$layer}='{$userid}'
                  and qishu='$qishu' and xtype!=2
                  and zc{$layer}>0 and pid='$pid'
                  and content='$content'");
    $tsql->next_record();
    $zcje = $tsql->f(0);

    // 5. ç»Ÿè®¡å·²é£å•é‡‘é¢
    $tsql->query("select sum(je)
                  from `$tb_lib`
                  where gid='$gid' and userid='$userid'
                  and qishu='$qishu' and pid='$pid'
                  and xtype=2 and content='$content'");
    $tsql->next_record();
    $yfje = $tsql->f(0);

    // 6. è®¡ç®—åº”é£å•é‡‘é¢
    $je = floor($zcje - $limitje - $yfje);

    if ($je >= 1) {
        if ($je > $maxje) {
            $je = $maxje; // é™åˆ¶å•æ¬¡é£å•é‡‘é¢
        }

        // 7. æ’å…¥é£å•è®°å½•ï¼ˆä¸Šçº§è´¦æˆ·ï¼‰
        $sql = "insert into `{$tb_lib}` set
                dates='$dates', gid='{$gid}', qishu='$qishu',
                tid='{$tid}', userid='{$userid}',
                bid='{$bid}', sid='{$sid}', cid='{$cid}', pid='$pid',
                abcd='A', ab='A', content='{$content}',
                time=NOW(), je='{$je}', xtype='1', z='9', bs=1,
                peilv1='{$tmppeilv}', peilv2='{$tmppeilv2}',
                bz='{$bz}', sv='1',
                ip=INET_ATON('127.0.0.1'), code='$key',
                flytype=1";
        $sql .= $sqle; // æ·»åŠ å æˆå­—æ®µ
        $tsql->query($sql);
        $tid++;
    }
}
```

**é£å•è®¡ç®—å…¬å¼**ï¼š

```
é£å•é‡‘é¢ = æ€»å æˆé‡‘é¢ - é£å•é˜ˆå€¼ - å·²é£å•é‡‘é¢
é£å•é‡‘é¢ = MIN(é£å•é‡‘é¢, å•æ¬¡æœ€å¤§é‡‘é¢)
```

---

### âœ… **3. åŒ…ç æ§åˆ¶ï¼ˆBao Maï¼‰**

**åŠŸèƒ½**ï¼šé™åˆ¶å•ä¸ªå·ç çš„æœ€å¤§æŠ•æ³¨é¢ï¼Œè¶…è¿‡åå°ç›˜æˆ–é™èµ”

**é…ç½®å¼€å…³**ï¼š
- å…¨å±€å¼€å…³ï¼š`x_config.autobaoma`ï¼ˆ`hide/sysconfig.php:73`ï¼‰
- ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„

**è§¦å‘æ¡ä»¶**ï¼š
- å•ä¸ªå·ç æŠ•æ³¨é¢ > è®¾å®šé˜ˆå€¼
- è‡ªåŠ¨é™ä½è¯¥å·ç èµ”ç‡æˆ–ç¦æ­¢ç»§ç»­æŠ•æ³¨

---

## ä¸‰ã€ç®¡ç†ç•Œé¢ä¸æ“ä½œæµç¨‹

### ğŸ“Š **ç®¡ç†å…¥å£**

| åŠŸèƒ½ | è®¿é—®è·¯å¾„ | æè¿° |
|------|---------|------|
| è‡ªåŠ¨é™èµ”é…ç½® | `/hide/libset.php?xtype=auto&gid=100` | é…ç½®è§¦å‘é‡‘é¢ã€é™èµ”å¹…åº¦ |
| è‡ªåŠ¨è¡¥è´§é…ç½® | `/hide/libset.php?xtype=show&gid=100` | é…ç½®é£å•é™é¢ |
| ç³»ç»Ÿæ€»å¼€å…³ | `/hide/sysconfig.php?xtype=show` | å…¨å±€å¯ç”¨/ç¦ç”¨æ§ç›˜ |
| å„ç›˜å·®åˆ†å‚æ•° | `/hide/setatt.php?xtype=show` | é…ç½® A/B/C/D ç›˜å·® |

---

### ğŸ”§ **æ“ä½œæ­¥éª¤ï¼ˆä»¥é¦™æ¸¯å…­åˆå½©ä¸ºä¾‹ï¼‰**

#### **æ­¥éª¤ 1ï¼šå¯ç”¨æ§ç›˜æ€»å¼€å…³**

1. è®¿é—® `/hide/sysconfig.php?xtype=show`
2. æ‰¾åˆ°é…ç½®é¡¹ï¼š
   - `comattpeilv` = **1**ï¼ˆå¯ç”¨è‡ªåŠ¨é™èµ”ï¼‰
   - `autobaoma` = **1**ï¼ˆå¯ç”¨åŒ…ç æ§åˆ¶ï¼‰
   - `flyflag` = **1**ï¼ˆå¯ç”¨é£å•ï¼‰
   - `autoresetpl` = **1**ï¼ˆå¼€å¥–åè‡ªåŠ¨é‡ç½®èµ”ç‡ï¼‰
3. ç‚¹å‡»"ä¿å­˜"

---

#### **æ­¥éª¤ 2ï¼šé…ç½®è‡ªåŠ¨é™èµ”å‚æ•°**

1. è®¿é—® `/hide/libset.php?xtype=auto&gid=100`
2. é…ç½®å„ç©æ³•å‚æ•°ï¼ˆä»¥"ç‰¹ç ä¸¤é¢"ä¸ºä¾‹ï¼‰ï¼š

| å‚æ•°å | å­—æ®µå | ç¤ºä¾‹å€¼ | è¯´æ˜ |
|--------|--------|--------|------|
| å¯ç”¨å¼€å…³ | `ifok` | 1 | 1=å¯ç”¨ï¼Œ0=ç¦ç”¨ |
| è§¦å‘é‡‘é¢ | `startje` | 10000 | æŠ•æ³¨é¢è¾¾åˆ°æ­¤å€¼å¼€å§‹é™èµ” |
| åˆå§‹é™å¹… | `startpeilv` | 0.01 | é¦–æ¬¡é™ä½èµ”ç‡ 0.01 |
| é€’å¢é‡‘é¢ | `addje` | 5000 | æ¯å¢åŠ  5000 å…ƒè§¦å‘ä¸€æ¬¡ |
| é€’å¢é™å¹… | `attpeilv` | 0.02 | æ¯æ¬¡é™ä½ 0.02 |
| æœ€ä½èµ”ç‡ | `lowpeilv` | 1.80 | èµ”ç‡ä¸ä¼šä½äºæ­¤å€¼ |
| åœæ­¢æŠ•æ³¨é¢ | `stopje` | 100000 | è¾¾åˆ°æ­¤å€¼å°ç›˜ |
| è®¡ç®—å æˆ | `ifzc` | 1 | 1=æŒ‰å æˆè®¡ç®—ï¼Œ0=æŒ‰å®é™…é‡‘é¢ |
| é¢„è­¦å¼€å…³ | `yj` | 0 | 1=å¯ç”¨æå‰é¢„è­¦ |
| æå‰æœŸæ•° | `qsnum` | 0 | æå‰ N æœŸå¼€å§‹é™èµ” |
| æå‰é™å¹… | `qspeilv` | 0.00 | æå‰æœŸæ•°çš„é™å¹… |

3. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®

**å‰ç«¯ JavaScript ä»£ç **ï¼ˆ`hide/libset.php:92-119`ï¼‰ï¼š
```javascript
// æäº¤é…ç½®
var arr = [];
$('.autolist tbody tr').each(function(){
    arr.push({
        ifok: $(this).find('.ifok').val(),
        yj: $(this).find('.yj').val(),
        qsnum: $(this).find('.qsnum').val(),
        qspeilv: $(this).find('.qspeilv').val(),
        startje: $(this).find('.startje').val(),
        startpeilv: $(this).find('.startpeilv').val(),
        addje: $(this).find('.addje').val(),
        attpeilv: $(this).find('.attpeilv').val(),
        lowpeilv: $(this).find('.lowpeilv').val(),
        stopje: $(this).find('.stopje').val(),
        ifzc: $(this).find('.ifzc').val(),
        ftype: $(this).find('.ftype').val()
    });
});

$.post('libset.php?xtype=setauto', {
    str: JSON.stringify(arr),
    gid: gid
}, function(data){
    if(data == 1) alert('ä¿å­˜æˆåŠŸ');
});
```

---

#### **æ­¥éª¤ 3ï¼šæµ‹è¯•é™èµ”æ•ˆæœ**

å‡è®¾åˆå§‹èµ”ç‡ä¸º **1.95**ï¼Œé…ç½®å¦‚ä¸‹ï¼š
- è§¦å‘é‡‘é¢ï¼š10000
- åˆå§‹é™å¹…ï¼š0.01
- é€’å¢é‡‘é¢ï¼š5000
- é€’å¢é™å¹…ï¼š0.02
- æœ€ä½èµ”ç‡ï¼š1.80

**é™èµ”è¿‡ç¨‹æ¨¡æ‹Ÿ**ï¼š

| ç´¯è®¡æŠ•æ³¨é¢ | è®¡ç®—å…¬å¼ | é™èµ”æ¬¡æ•° | å½“å‰èµ”ç‡ | è¯´æ˜ |
|-----------|---------|---------|---------|------|
| 0-9999 | - | 0 | **1.95** | æœªè§¦å‘ |
| 10000 | é¦–æ¬¡è§¦å‘ | 1 | 1.95 - 0.01 = **1.94** | åˆå§‹é™å¹… |
| 15000 | (15000-10000)/5000 + 1 | 2 | 1.95 - 0.01 - 0.02Ã—1 = **1.92** | è§¦å‘ 1 æ¬¡é€’å¢ |
| 20000 | (20000-10000)/5000 + 1 | 3 | 1.95 - 0.01 - 0.02Ã—2 = **1.90** | è§¦å‘ 2 æ¬¡é€’å¢ |
| 25000 | (25000-10000)/5000 + 1 | 4 | 1.95 - 0.01 - 0.02Ã—3 = **1.88** | è§¦å‘ 3 æ¬¡é€’å¢ |
| 30000 | è§¦å‘ | 5 | 1.95 - 0.01 - 0.02Ã—4 = **1.86** | è§¦å‘ 4 æ¬¡é€’å¢ |
| 35000 | è§¦å‘ | 6 | 1.95 - 0.01 - 0.02Ã—5 = **1.84** | è§¦å‘ 5 æ¬¡é€’å¢ |
| 40000 | è§¦å‘ | 7 | 1.95 - 0.01 - 0.02Ã—6 = **1.82** | è§¦å‘ 6 æ¬¡é€’å¢ |
| 45000 | è§¦å‘ | 8 | 1.95 - 0.01 - 0.02Ã—7 = **1.80** | **è¾¾åˆ°æœ€ä½èµ”ç‡** |
| 50000+ | è§¦å‘ | 9+ | **1.80** | ä¿æŒæœ€ä½èµ”ç‡ |
| 100000+ | è¾¾åˆ°å°ç›˜é‡‘é¢ | - | **å°ç›˜** | ç¦æ­¢ç»§ç»­æŠ•æ³¨ |

---

#### **æ­¥éª¤ 4ï¼šé…ç½®é£å•å‚æ•°**

1. è®¿é—® `/hide/libset.php?xtype=show&gid=100`
2. ä¸ºæ¯ä¸ªç©æ³•è®¾ç½®é£å•é˜ˆå€¼å’Œæœ€å¤§é‡‘é¢ï¼š

| ç©æ³• | é£å•é˜ˆå€¼ï¼ˆjeï¼‰ | å•æ¬¡æœ€å¤§é‡‘é¢ï¼ˆmaxjeï¼‰ | å¯ç”¨ï¼ˆifokï¼‰ |
|------|---------------|---------------------|-------------|
| ç‰¹ç ä¸¤é¢ | 5000 | 10000 | 1 |
| æ­£ç  | 3000 | 5000 | 1 |
| è¿ç  | 10000 | 20000 | 1 |

**é£å•è§¦å‘ç¤ºä¾‹**ï¼š
- ä¸‹çº§æ€»æŠ•æ³¨é¢ï¼ˆå æˆï¼‰ï¼š12000 å…ƒ
- é£å•é˜ˆå€¼ï¼š5000 å…ƒ
- å·²é£å•ï¼š2000 å…ƒ
- **æœ¬æ¬¡åº”é£å•**ï¼š12000 - 5000 - 2000 = **5000 å…ƒ**

---

## å››ã€æ•°æ®åº“æ“ä½œè¯¦è§£

### ğŸ“‹ **æ¶‰åŠçš„æ•°æ®è¡¨**

#### **1. x_autoï¼ˆè‡ªåŠ¨é™èµ”é…ç½®è¡¨ï¼‰**

**è¡¨ç»“æ„**ï¼š
```sql
CREATE TABLE `x_auto` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢ID',
  `gid` int(3) NOT NULL COMMENT 'æ¸¸æˆIDï¼ˆå¦‚100=é¦™æ¸¯å…­åˆå½©ï¼‰',
  `userid` int(8) NOT NULL COMMENT 'ç”¨æˆ·IDï¼ˆ99999999=ç³»ç»Ÿï¼‰',
  `class` varchar(10) NOT NULL COMMENT 'ç©æ³•ç±»å‹ï¼ˆå¦‚ï¼šä¸¤é¢ã€ç‰¹ç ã€æ­£ç ï¼‰',
  `ifok` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦å¯ç”¨ï¼ˆ0=å¦ï¼Œ1=æ˜¯ï¼‰',
  `startje` decimal(10,2) DEFAULT 0 COMMENT 'è§¦å‘é‡‘é¢ï¼ˆå…ƒï¼‰',
  `startpeilv` decimal(10,4) DEFAULT 0 COMMENT 'åˆå§‹é™å¹…ï¼ˆå¦‚0.01è¡¨ç¤ºé™ä½0.01ï¼‰',
  `addje` decimal(10,2) DEFAULT 0 COMMENT 'é€’å¢é‡‘é¢ï¼ˆå…ƒï¼‰',
  `attpeilv` decimal(10,4) DEFAULT 0 COMMENT 'æ¯æ¬¡é™å¹…ï¼ˆå¦‚0.02ï¼‰',
  `lowpeilv` decimal(10,4) DEFAULT 0 COMMENT 'æœ€ä½èµ”ç‡ï¼ˆå¦‚1.80ï¼‰',
  `stopje` decimal(10,2) DEFAULT 0 COMMENT 'å°ç›˜é‡‘é¢ï¼ˆå…ƒï¼‰',
  `ifzc` tinyint(1) DEFAULT 1 COMMENT 'æ˜¯å¦æŒ‰å æˆè®¡ç®—ï¼ˆ1=æ˜¯ï¼Œ0=å¦ï¼‰',
  `yj` tinyint(1) DEFAULT 0 COMMENT 'é¢„è­¦å¼€å…³ï¼ˆ1=å¯ç”¨ï¼‰',
  `qsnum` int(3) DEFAULT 0 COMMENT 'æå‰æœŸæ•°ï¼ˆå¦‚1è¡¨ç¤ºæå‰1æœŸï¼‰',
  `qspeilv` decimal(10,4) DEFAULT 0 COMMENT 'æå‰é™å¹…ï¼ˆæå‰æœŸæ•°çš„é™ä½å¹…åº¦ï¼‰',
  PRIMARY KEY (`id`),
  KEY `idx_gid_class` (`gid`, `class`, `userid`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COMMENT='è‡ªåŠ¨é™èµ”é…ç½®è¡¨';
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```sql
-- é¦™æ¸¯å…­åˆå½©"ç‰¹ç ä¸¤é¢"çš„é™èµ”é…ç½®
INSERT INTO x_auto VALUES
(1, 100, 99999999, 'ä¸¤é¢', 1, 10000.00, 0.0100, 5000.00, 0.0200, 1.8000, 100000.00, 1, 0, 0, 0.0000);

-- è§£è¯»ï¼š
-- gid=100: é¦™æ¸¯å…­åˆå½©
-- userid=99999999: ç³»ç»Ÿçº§é…ç½®
-- class='ä¸¤é¢': ç©æ³•ç±»å‹ä¸º"ä¸¤é¢"ï¼ˆå¤§å°/å•åŒï¼‰
-- ifok=1: å¯ç”¨
-- startje=10000: æŠ•æ³¨é¢è¾¾åˆ°10000å…ƒå¼€å§‹é™èµ”
-- startpeilv=0.01: é¦–æ¬¡é™ä½0.01
-- addje=5000: æ¯å¢åŠ 5000å…ƒè§¦å‘ä¸€æ¬¡
-- attpeilv=0.02: æ¯æ¬¡é™ä½0.02
-- lowpeilv=1.80: æœ€ä½èµ”ç‡1.80
-- stopje=100000: è¾¾åˆ°10ä¸‡å…ƒå°ç›˜
-- ifzc=1: æŒ‰å æˆè®¡ç®—
```

---

#### **2. x_playï¼ˆç©æ³•èµ”ç‡è¡¨ï¼‰**

**å…³é”®å­—æ®µ**ï¼š
```sql
`peilv1` decimal(10,4) NOT NULL DEFAULT 0 COMMENT 'å½“å‰èµ”ç‡ï¼ˆä¼šè¢« attpeilvs åŠ¨æ€ä¿®æ”¹ï¼‰',
`mp1` decimal(10,4) NOT NULL DEFAULT 0 COMMENT 'åŸå§‹èµ”ç‡ï¼ˆç”¨äºé‡ç½®ï¼‰',
`ystart` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦å·²å¼€å§‹é™èµ”ï¼ˆ0=æœªå¼€å§‹ï¼Œ1=å·²å¼€å§‹ï¼‰',
`yautocs` int(5) DEFAULT 0 COMMENT 'å·²é™èµ”æ¬¡æ•°',
`start` tinyint(1) DEFAULT 0 COMMENT 'é™èµ”çŠ¶æ€æ ‡å¿—',
`autocs` int(5) DEFAULT 0 COMMENT 'è‡ªåŠ¨è°ƒæ•´æ¬¡æ•°',
```

**é™èµ”æµç¨‹**ï¼š
```sql
-- 1. é¦–æ¬¡è§¦å‘é™èµ”
UPDATE x_play SET
    ystart = 1,           -- æ ‡è®°å·²å¼€å§‹
    yautocs = 1,          -- é™èµ”æ¬¡æ•°=1
    peilv1 = peilv1 - 0.01  -- é™ä½åˆå§‹å¹…åº¦
WHERE gid='100' AND pid='23378685';

-- 2. åç»­è§¦å‘é™èµ”
UPDATE x_play SET
    yautocs = 3,          -- é™èµ”æ¬¡æ•°=3
    peilv1 = IF(peilv1 - 2*0.02 > 1.80, peilv1 - 2*0.02, 1.80)  -- é™ä½ä½†ä¸ä½äºæœ€ä½èµ”ç‡
WHERE gid='100' AND pid='23378685';

-- 3. å¼€å¥–åé‡ç½®èµ”ç‡ï¼ˆç”± attpeilv() å‡½æ•°æ‰§è¡Œï¼‰
UPDATE x_play SET
    peilv1 = mp1,         -- æ¢å¤åŸå§‹èµ”ç‡
    ystart = 0,           -- é‡ç½®æ ‡å¿—
    yautocs = 0           -- æ¸…é›¶æ¬¡æ•°
WHERE gid='100';
```

---

#### **3. x_peilvï¼ˆèµ”ç‡å˜æ›´æ—¥å¿—è¡¨ï¼‰**

**ä½œç”¨**ï¼šè®°å½•æ¯æ¬¡èµ”ç‡è°ƒæ•´ï¼Œç”¨äºå®¡è®¡å’Œå›æº¯

**è¡¨ç»“æ„**ï¼š
```sql
CREATE TABLE `x_peilv` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `gid` int(3) NOT NULL COMMENT 'æ¸¸æˆID',
  `pid` int(8) NOT NULL COMMENT 'ç©æ³•ID',
  `peilv` decimal(10,4) NOT NULL COMMENT 'èµ”ç‡å˜åŒ–ï¼ˆæ­£æ•°=ä¸Šè°ƒï¼Œè´Ÿæ•°=ä¸‹è°ƒï¼‰',
  `time` datetime NOT NULL COMMENT 'å˜æ›´æ—¶é—´',
  `userid` int(8) NOT NULL COMMENT 'æ“ä½œç”¨æˆ·ID',
  `sonuser` varchar(50) DEFAULT NULL COMMENT 'å­ç”¨æˆ·æ ‡è¯†',
  `auto` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦è‡ªåŠ¨è°ƒæ•´ï¼ˆ0=æ‰‹åŠ¨ï¼Œ1=è‡ªåŠ¨ï¼‰',
  PRIMARY KEY (`id`),
  KEY `idx_gid_pid_time` (`gid`, `pid`, `time`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
```

**æ’å…¥æ—¥å¿—ç¤ºä¾‹**ï¼š
```sql
-- è‡ªåŠ¨é™èµ”è®°å½•
INSERT INTO x_peilv SET
    gid='100',
    pid='23378685',
    peilv='-0.02',           -- è´Ÿæ•°è¡¨ç¤ºé™ä½
    time=NOW(),
    userid='99999999',
    sonuser='11111111',
    auto=1;                  -- 1=è‡ªåŠ¨è°ƒæ•´

-- æ‰‹åŠ¨è°ƒæ•´è®°å½•
INSERT INTO x_peilv SET
    gid='100',
    pid='23378685',
    peilv='0.05',            -- æ­£æ•°è¡¨ç¤ºä¸Šè°ƒ
    time=NOW(),
    userid='10001001',       -- ç®¡ç†å‘˜ID
    sonuser='',
    auto=0;                  -- 0=æ‰‹åŠ¨è°ƒæ•´
```

**æŸ¥è¯¢é™èµ”å†å²**ï¼š
```sql
-- æŸ¥è¯¢æŸä¸ªç©æ³•çš„é™èµ”å†å²
SELECT
    time AS 'æ—¶é—´',
    peilv AS 'èµ”ç‡å˜åŒ–',
    CASE auto
        WHEN 1 THEN 'è‡ªåŠ¨'
        ELSE 'æ‰‹åŠ¨'
    END AS 'è°ƒæ•´æ–¹å¼'
FROM x_peilv
WHERE gid='100' AND pid='23378685'
ORDER BY time DESC
LIMIT 20;
```

---

#### **4. x_libï¼ˆæŠ•æ³¨è®°å½•è¡¨ï¼‰**

**æ§ç›˜ç›¸å…³å­—æ®µ**ï¼š
```sql
`je` decimal(10,2) NOT NULL COMMENT 'æŠ•æ³¨é‡‘é¢',
`zc0` int(3) DEFAULT 0 COMMENT 'ç³»ç»Ÿå æˆæ¯”ä¾‹ï¼ˆ0-100ï¼‰',
`zc1` int(3) DEFAULT 0 COMMENT 'ä¸€çº§ä»£ç†å æˆæ¯”ä¾‹',
`zc2` int(3) DEFAULT 0 COMMENT 'äºŒçº§ä»£ç†å æˆæ¯”ä¾‹',
...
`flytype` int(1) DEFAULT 0 COMMENT 'é£å•ç±»å‹ï¼ˆ0=æ— ï¼Œ1=ä¸Šçº§é£å•ï¼Œ2=ç¬¬ä¸‰æ–¹å¯¹å†²ï¼‰',
`xtype` int(1) DEFAULT 1 COMMENT 'æ³¨å•ç±»å‹ï¼ˆ1=ç”¨æˆ·æŠ•æ³¨ï¼Œ2=å¯¹å†²å•ï¼‰',
```

**ç»Ÿè®¡æŠ•æ³¨é¢ç¤ºä¾‹**ï¼š
```sql
-- ç»Ÿè®¡æŸä¸ªç©æ³•çš„æ€»æŠ•æ³¨é¢ï¼ˆæŒ‰å æˆè®¡ç®—ï¼‰
SELECT
    pid,
    SUM(je * zc0 / 100) AS total_zc
FROM x_lib
WHERE gid='100'
  AND qishu='2024001'
  AND xtype!=2         -- æ’é™¤å¯¹å†²å•
  AND zc0 > 0          -- æœ‰å æˆ
GROUP BY pid;

-- ç»Ÿè®¡æŸä¸ªç©æ³•çš„ç”¨æˆ·æŠ•æ³¨é¢ï¼ˆä¸æŒ‰å æˆï¼‰
SELECT
    pid,
    SUM(je) AS total_je
FROM x_lib
WHERE gid='100'
  AND qishu='2024001'
  AND xtype!=2
GROUP BY pid;
```

---

#### **5. x_flyï¼ˆé£å•é…ç½®è¡¨ï¼‰**

**è¡¨ç»“æ„**ï¼š
```sql
CREATE TABLE `x_fly` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `gid` int(3) NOT NULL COMMENT 'æ¸¸æˆID',
  `userid` int(8) NOT NULL COMMENT 'ç”¨æˆ·ID',
  `class` varchar(10) NOT NULL COMMENT 'ç©æ³•ç±»å‹',
  `ab` char(1) NOT NULL COMMENT 'Aç›˜æˆ–Bç›˜',
  `je` decimal(10,2) DEFAULT 0 COMMENT 'é£å•é˜ˆå€¼ï¼ˆå…ƒï¼‰',
  `maxje` decimal(10,2) DEFAULT 0 COMMENT 'å•æ¬¡æœ€å¤§é£å•é‡‘é¢ï¼ˆå…ƒï¼‰',
  `ifok` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦å¯ç”¨',
  PRIMARY KEY (`id`),
  KEY `idx_gid_userid_class` (`gid`, `userid`, `class`, `ab`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```sql
-- ç³»ç»Ÿè´¦æˆ·çš„é£å•é…ç½®
INSERT INTO x_fly VALUES
(1, 100, 99999999, 'ä¸¤é¢', 'A', 5000.00, 10000.00, 1);

-- è§£è¯»ï¼š
-- ç©æ³•"ä¸¤é¢"çš„æŠ•æ³¨é¢è¶…è¿‡5000å…ƒåå¼€å§‹é£å•
-- å•æ¬¡é£å•é‡‘é¢ä¸è¶…è¿‡10000å…ƒ
```

---

#### **6. x_configï¼ˆç³»ç»Ÿé…ç½®è¡¨ï¼‰**

**æ§ç›˜ç›¸å…³å­—æ®µ**ï¼š
```sql
`comattpeilv` tinyint(1) DEFAULT 0 COMMENT 'å¯ç”¨è‡ªåŠ¨é™èµ”ï¼ˆ0=å…³é—­ï¼Œ1=å¯ç”¨ï¼‰',
`autobaoma` tinyint(1) DEFAULT 0 COMMENT 'å¯ç”¨åŒ…ç æ§åˆ¶ï¼ˆ0=å…³é—­ï¼Œ1=å¯ç”¨ï¼‰',
`flyflag` tinyint(1) DEFAULT 0 COMMENT 'å¯ç”¨é£å•ï¼ˆ0=å…³é—­ï¼Œ1=å¯ç”¨ï¼‰',
`autoresetpl` tinyint(1) DEFAULT 1 COMMENT 'å¼€å¥–åè‡ªåŠ¨é‡ç½®èµ”ç‡ï¼ˆ0=å¦ï¼Œ1=æ˜¯ï¼‰',
`autold` tinyint(1) DEFAULT 0 COMMENT 'è‡ªåŠ¨é¾™è™ï¼ˆ0=å…³é—­ï¼Œ1=å¯ç”¨ï¼‰',
`plresetfs` varchar(10) DEFAULT 'now' COMMENT 'èµ”ç‡é‡ç½®æ–¹å¼ï¼ˆnow=ç«‹å³ï¼Œnext=ä¸‹æœŸï¼‰',
```

**è¯»å–é…ç½®**ï¼š
```sql
SELECT
    comattpeilv AS 'è‡ªåŠ¨é™èµ”',
    autobaoma AS 'åŒ…ç æ§åˆ¶',
    flyflag AS 'é£å•',
    autoresetpl AS 'è‡ªåŠ¨é‡ç½®èµ”ç‡'
FROM x_config
LIMIT 1;
```

---

## äº”ã€å®Œæ•´æ‰§è¡Œæµç¨‹å›¾

```mermaid
graph TB
    A[ç”¨æˆ·ä¸‹æ³¨] -->|å†™å…¥| B[(x_lib æŠ•æ³¨è¡¨)]
    B --> C{å®šæ—¶ä»»åŠ¡<br/>autos_ss.php}
    C -->|æ¯æ¬¡å¼€ç›˜| D[è°ƒç”¨ attpeilvs]
    D --> E{æŸ¥è¯¢ x_auto é…ç½®}
    E -->|æœªå¯ç”¨ ifok=0| F[è·³è¿‡]
    E -->|å·²å¯ç”¨ ifok=1| G[ç»Ÿè®¡æŠ•æ³¨é¢]
    G --> H{æŠ•æ³¨é¢ >= è§¦å‘é‡‘é¢?}
    H -->|å¦| F
    H -->|æ˜¯| I{é¦–æ¬¡è§¦å‘?}
    I -->|æ˜¯ ystart=0| J[é™ä½åˆå§‹å¹…åº¦]
    I -->|å¦ ystart=1| K[è®¡ç®—é™èµ”æ¬¡æ•°]
    K --> L[æ›´æ–° x_play.peilv1]
    J --> L
    L --> M[è®°å½• x_peilv æ—¥å¿—]
    M --> N[ä¸‹æ¬¡æŠ•æ³¨ä½¿ç”¨æ–°èµ”ç‡]

    B --> O{å®šæ—¶ä»»åŠ¡<br/>autoflys_ss.php}
    O -->|æ¯10ç§’| P[æŸ¥è¯¢ä¸‹çº§æŠ•æ³¨]
    P --> Q[è®¡ç®—é£å•é‡‘é¢]
    Q --> R{é‡‘é¢ >= 1?}
    R -->|å¦| S[è·³è¿‡]
    R -->|æ˜¯| T[æ’å…¥ä¸Šçº§æ³¨å•]
    T --> U[æ ‡è®° flytype=1]

    N --> V{å¼€å¥–}
    V --> W[è°ƒç”¨ attpeilv]
    W --> X[é‡ç½®èµ”ç‡ peilv1=mp1]
    X --> Y[æ¸…é›¶è®¡æ•°å™¨ yautocs=0]

    style D fill:#ff9999
    style L fill:#99ff99
    style T fill:#9999ff
    style X fill:#ffff99
```

---

## å…­ã€å…³é”®ä»£ç ä½ç½®

### ğŸ“‚ **æ ¸å¿ƒæ–‡ä»¶æ¸…å•**

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· | æè¿° |
|------|---------|------|------|
| è‡ªåŠ¨é™èµ”ä¸»å‡½æ•° | `func/adminfunc.php` | 620-736 | `attpeilvs($gid)` |
| å¼€å¥–åé‡ç½®èµ”ç‡ | `func/adminfunc.php` | 737-850 | `attpeilv($gid)` |
| å®šæ—¶è°ƒç”¨é™èµ” | `tools/autos_ss.php` | 100, 274 | `attpeilvs($gid)` |
| é£å•ä¸»é€»è¾‘ | `tools/autoflys_ss.php` | 238-378 | è®¡ç®—å¹¶æ’å…¥é£å• |
| é™èµ”é…ç½®é¡µé¢ | `hide/libset.php` | 55-119 | case 'auto', 'setauto' |
| é£å•é…ç½®é¡µé¢ | `hide/libset.php` | 121-204 | case 'show', 'setautofly' |
| ç³»ç»Ÿé…ç½®é¡µé¢ | `hide/sysconfig.php` | 10-51 | case 'show' |
| ä¿å­˜ç³»ç»Ÿé…ç½® | `hide/sysconfig.php` | 53-104 | case 'setsys' |
| å„ç›˜å·®åˆ†é…ç½® | `hide/setatt.php` | 10-58 | case 'show', 'setatt' |

---

## ä¸ƒã€é£é™©ä¸é™åˆ¶

### âš ï¸ **å®‰å…¨é£é™©**

1. **ç¼ºå°‘æƒé™éªŒè¯**ï¼š
   - `libset.php` ä¾èµ– Sessionï¼ˆ`checklogin.php`ï¼‰ï¼Œä½†æœªéªŒè¯æ“ä½œæƒé™ç­‰çº§
   - å»ºè®®æ·»åŠ ï¼š
     ```php
     if ($_SESSION['level'] != 1) { // éè¶…çº§ç®¡ç†å‘˜
         die('æƒé™ä¸è¶³');
     }
     ```

2. **SQL æ³¨å…¥é£é™©**ï¼š
   ```php
   // å±é™©ä»£ç ç¤ºä¾‹ï¼ˆlibset.php:97ï¼‰
   $msql->query("delete from `$tb_auto` where userid='$userid' and gid='$gid'");
   // æœªä½¿ç”¨é¢„å¤„ç†è¯­å¥

   // å»ºè®®æ”¹ä¸ºï¼š
   $stmt = $pdo->prepare("DELETE FROM x_auto WHERE userid=? AND gid=?");
   $stmt->execute([$userid, $gid]);
   ```

3. **ç«æ€æ¡ä»¶**ï¼š
   - å¤šä¸ªå®šæ—¶ä»»åŠ¡åŒæ—¶ä¿®æ”¹èµ”ç‡å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
   - å»ºè®®æ·»åŠ æ•°æ®åº“é”ï¼š
     ```php
     $msql->query("SELECT * FROM x_play WHERE pid='$pid' FOR UPDATE");
     ```

4. **æ€§èƒ½ç“¶é¢ˆ**ï¼š
   - `attpeilvs()` å‡½æ•°åœ¨é«˜å¹¶å‘æ—¶é¢‘ç¹æŸ¥è¯¢ `x_lib` è¡¨
   - å»ºè®®ä¼˜åŒ–ï¼š
     ```sql
     -- æ·»åŠ ç´¢å¼•
     CREATE INDEX idx_lib_query ON x_lib(gid, qishu, pid, xtype, zc0);

     -- ä½¿ç”¨è¦†ç›–ç´¢å¼•
     SELECT pid, SUM(je*zc0/100) as total
     FROM x_lib
     WHERE gid='100' AND qishu='2024001' AND xtype!=2
     GROUP BY pid;
     ```

5. **æ—¥å¿—è†¨èƒ€**ï¼š
   - `x_peilv` è¡¨ä¼šå¿«é€Ÿå¢é•¿
   - å»ºè®®å®šæœŸæ¸…ç†ï¼š
     ```sql
     -- åˆ é™¤30å¤©å‰çš„æ—¥å¿—
     DELETE FROM x_peilv WHERE time < DATE_SUB(NOW(), INTERVAL 30 DAY);
     ```

---

### ğŸ”’ **ä¸šåŠ¡é£é™©**

1. **é™èµ”è¿‡å¿«å¯¼è‡´ç”¨æˆ·æµå¤±**ï¼š
   - å»ºè®®è®¾ç½®åˆç†çš„ `addje`ï¼ˆé€’å¢é‡‘é¢ï¼‰å’Œ `attpeilv`ï¼ˆæ¯æ¬¡é™å¹…ï¼‰
   - é¿å…èµ”ç‡å˜åŒ–è¿‡äºé¢‘ç¹

2. **é£å•å¤±è´¥å¯¼è‡´é£é™©ç´¯ç§¯**ï¼š
   - å»ºè®®ç›‘æ§é£å•æˆåŠŸç‡
   - å¤±è´¥æ—¶å‘é€å‘Šè­¦é€šçŸ¥

3. **é…ç½®é”™è¯¯å¯¼è‡´äºæŸ**ï¼š
   - å»ºè®®æ·»åŠ é…ç½®å®¡æ ¸æœºåˆ¶
   - ä¿®æ”¹é…ç½®éœ€è¦äºŒæ¬¡ç¡®è®¤

---

## å…«ã€ä¼˜åŒ–å»ºè®®

### ğŸš€ **é«˜ä¼˜å…ˆçº§ï¼ˆ1 å‘¨å†…å®Œæˆï¼‰**

#### 1. **æ·»åŠ  Redis ç¼“å­˜**
```php
// ç¼“å­˜èµ”ç‡é…ç½®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
function getAutoConfig($gid, $class) {
    $key = "auto_config:{$gid}:{$class}";
    $config = Redis::get($key);

    if (!$config) {
        $config = DB::query("SELECT * FROM x_auto
                             WHERE gid='$gid' AND class='$class'");
        Redis::set($key, json_encode($config), 60); // ç¼“å­˜60ç§’
    } else {
        $config = json_decode($config, true);
    }

    return $config;
}
```

#### 2. **å¼‚æ­¥å¤„ç†é™èµ”**
```php
// ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œ
function attpeilvs($gid) {
    Queue::push('AdjustOddsJob', ['gid' => $gid]);
}

// Worker å¤„ç†
class AdjustOddsJob {
    public function handle($data) {
        $gid = $data['gid'];
        // æ‰§è¡Œé™èµ”é€»è¾‘...
    }
}
```

#### 3. **æ·»åŠ æƒé™æ§åˆ¶**
```php
// hide/libset.php å¤´éƒ¨æ·»åŠ 
if ($_SESSION['level'] != 1) {
    die(json_encode(['code' => 403, 'msg' => 'æƒé™ä¸è¶³']));
}

// æ“ä½œæ—¥å¿—
userchange("ä¿®æ”¹è‡ªåŠ¨é™èµ”é…ç½®: gid={$gid}", $userid);
```

---

### ğŸ“Š **ä¸­ä¼˜å…ˆçº§ï¼ˆ2 å‘¨å†…å®Œæˆï¼‰**

#### 1. **æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–**
```sql
-- ä¼˜åŒ– x_lib è¡¨æŸ¥è¯¢
CREATE INDEX idx_lib_auto ON x_lib(gid, qishu, xtype, zc0, pid);

-- ä¼˜åŒ– x_auto è¡¨æŸ¥è¯¢
CREATE INDEX idx_auto_query ON x_auto(gid, userid, class, ifok);

-- ä¼˜åŒ– x_peilv è¡¨æŸ¥è¯¢
CREATE INDEX idx_peilv_time ON x_peilv(gid, pid, time DESC);
```

#### 2. **æ·»åŠ æ“ä½œå®¡è®¡æ—¥å¿—**
```sql
-- åˆ›å»ºå®¡è®¡è¡¨
CREATE TABLE `x_audit_log` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `userid` int(8) NOT NULL COMMENT 'æ“ä½œç”¨æˆ·',
  `action` varchar(50) NOT NULL COMMENT 'æ“ä½œç±»å‹',
  `module` varchar(50) NOT NULL COMMENT 'åŠŸèƒ½æ¨¡å—',
  `content` text COMMENT 'æ“ä½œå†…å®¹ï¼ˆJSONï¼‰',
  `ip` varchar(50) DEFAULT NULL,
  `time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_userid_time` (`userid`, `time`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

-- æ’å…¥æ—¥å¿—
INSERT INTO x_audit_log SET
    userid='10001001',
    action='ä¿®æ”¹é™èµ”é…ç½®',
    module='æ§ç›˜',
    content='{"gid":100,"class":"ä¸¤é¢","startje":10000}',
    ip='192.168.1.100',
    time=NOW();
```

#### 3. **å‰ç«¯å®æ—¶é¢„è§ˆé™èµ”æ›²çº¿**
```javascript
// æ·»åŠ å›¾è¡¨åº“ï¼ˆå¦‚ Chart.jsï¼‰
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

// ç»˜åˆ¶é™èµ”æ›²çº¿
function drawOddsChart(startPeilv, startje, addje, attpeilv, lowpeilv) {
    var data = [];
    var labels = [];
    var peilv = startPeilv;

    for (var je = 0; je <= 100000; je += 5000) {
        labels.push(je);
        if (je >= startje) {
            var cs = Math.floor((je - startje) / addje) + 1;
            peilv = startPeilv - 0.01 - (cs - 1) * attpeilv;
            peilv = Math.max(peilv, lowpeilv);
        }
        data.push(peilv);
    }

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'èµ”ç‡å˜åŒ–',
                data: data,
                borderColor: 'rgb(75, 192, 192)'
            }]
        }
    });
}
```

---

### ğŸ¨ **ä½ä¼˜å…ˆçº§ï¼ˆ1 ä¸ªæœˆå†…å®Œæˆï¼‰**

#### 1. **æ™ºèƒ½é¢„è­¦æœºåˆ¶**
```php
// å½“æŠ•æ³¨é¢æ¥è¿‘è§¦å‘é˜ˆå€¼æ—¶å‘é€é¢„è­¦
function checkWarning($gid, $class, $currentJe, $startje) {
    $ratio = $currentJe / $startje;

    if ($ratio > 0.8 && $ratio < 1.0) {
        // å‘é€é‚®ä»¶/çŸ­ä¿¡é€šçŸ¥
        sendAlert("è­¦å‘Šï¼š{$gid} ç©æ³• {$class} æŠ•æ³¨é¢å·²è¾¾è§¦å‘é‡‘é¢çš„ " .
                  round($ratio * 100) . "%");
    }
}
```

#### 2. **é…ç½®ç‰ˆæœ¬ç®¡ç†**
```sql
-- åˆ›å»ºé…ç½®å†å²è¡¨
CREATE TABLE `x_auto_history` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `config_id` int(11) NOT NULL,
  `old_value` text,
  `new_value` text,
  `userid` int(8) NOT NULL,
  `time` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

-- æ”¯æŒå›æ»šåˆ°å†å²é…ç½®
```

#### 3. **å¤šç»´åº¦ç»Ÿè®¡æŠ¥è¡¨**
```sql
-- é™èµ”æ•ˆæœç»Ÿè®¡
SELECT
    gid,
    class,
    COUNT(*) AS adjust_times,
    AVG(peilv) AS avg_adjust,
    DATE(time) AS date
FROM x_peilv
WHERE auto=1
GROUP BY gid, class, DATE(time)
ORDER BY date DESC;
```

---

## ä¹ã€å¸¸è§é—®é¢˜ FAQ

### Q1ï¼šä¸ºä»€ä¹ˆè®¾ç½®äº†é™èµ”ä½†æ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ

**Aï¼š** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **ç³»ç»Ÿæ€»å¼€å…³æ˜¯å¦å¯ç”¨**ï¼š
   ```sql
   SELECT comattpeilv FROM x_config;
   -- åº”è¯¥è¿”å› 1
   ```

2. **ç©æ³•é…ç½®æ˜¯å¦å¯ç”¨**ï¼š
   ```sql
   SELECT ifok FROM x_auto WHERE gid='100' AND class='ä¸¤é¢';
   -- åº”è¯¥è¿”å› 1
   ```

3. **æŠ•æ³¨é¢æ˜¯å¦è¾¾åˆ°è§¦å‘é‡‘é¢**ï¼š
   ```sql
   SELECT SUM(je*zc0/100) FROM x_lib
   WHERE gid='100' AND qishu='2024001' AND xtype!=2;
   -- åº”è¯¥ >= startje
   ```

4. **å®šæ—¶ä»»åŠ¡æ˜¯å¦åœ¨è¿è¡Œ**ï¼š
   ```bash
   # æ£€æŸ¥ cj_kj.php æ˜¯å¦è¢«å®šæ—¶è°ƒç”¨
   tail -f /var/log/nginx/access.log | grep cj_kj.php
   ```

---

### Q2ï¼šèµ”ç‡é™å¾—å¤ªå¿«æ€ä¹ˆåŠï¼Ÿ

**Aï¼š** è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

- **å¢å¤§ `addje`**ï¼ˆé€’å¢é‡‘é¢ï¼‰ï¼šä» 5000 æ”¹ä¸º 10000
- **å‡å° `attpeilv`**ï¼ˆæ¯æ¬¡é™å¹…ï¼‰ï¼šä» 0.02 æ”¹ä¸º 0.01
- **æé«˜ `lowpeilv`**ï¼ˆæœ€ä½èµ”ç‡ï¼‰ï¼šä» 1.80 æ”¹ä¸º 1.85

**ç¤ºä¾‹é…ç½®ï¼ˆé™èµ”æ›´æ¸©å’Œï¼‰**ï¼š
```sql
UPDATE x_auto SET
    addje = 10000,      -- æ¯1ä¸‡å…ƒè§¦å‘ä¸€æ¬¡
    attpeilv = 0.01,    -- æ¯æ¬¡é™0.01
    lowpeilv = 1.85     -- æœ€ä½èµ”ç‡1.85
WHERE gid='100' AND class='ä¸¤é¢';
```

---

### Q3ï¼šå¦‚ä½•æŸ¥çœ‹é™èµ”å†å²è®°å½•ï¼Ÿ

**Aï¼š** æŸ¥è¯¢ `x_peilv` è¡¨ï¼š

```sql
-- æŸ¥è¯¢æœ€è¿‘20æ¬¡é™èµ”è®°å½•
SELECT
    p.time AS 'æ—¶é—´',
    g.gname AS 'æ¸¸æˆ',
    pl.name AS 'ç©æ³•',
    p.peilv AS 'èµ”ç‡å˜åŒ–',
    CASE p.auto
        WHEN 1 THEN 'è‡ªåŠ¨'
        ELSE 'æ‰‹åŠ¨'
    END AS 'è°ƒæ•´æ–¹å¼'
FROM x_peilv p
LEFT JOIN x_game g ON p.gid = g.gid
LEFT JOIN x_play pl ON p.pid = pl.pid
WHERE p.gid='100'
ORDER BY p.time DESC
LIMIT 20;
```

---

### Q4ï¼šé£å•åˆ°å“ªé‡Œå»äº†ï¼Ÿ

**Aï¼š** é£å•è®°å½•åœ¨ `x_lib` è¡¨ä¸­ï¼Œç‰¹å¾ï¼š

- `userid` = 99999999ï¼ˆç³»ç»Ÿè´¦æˆ·ï¼‰æˆ–ä¸Šçº§ä»£ç†è´¦æˆ·
- `flytype` = 1ï¼ˆé£å•æ ‡è¯†ï¼‰
- `xtype` = 1ï¼ˆæ­£å¸¸æŠ•æ³¨ç±»å‹ï¼‰

**æŸ¥è¯¢é£å•è®°å½•**ï¼š
```sql
SELECT
    qishu AS 'æœŸå·',
    je AS 'é‡‘é¢',
    time AS 'æ—¶é—´'
FROM x_lib
WHERE gid='100'
  AND userid='99999999'
  AND flytype=1
ORDER BY time DESC
LIMIT 20;
```

---

### Q5ï¼šå¦‚ä½•ä¸´æ—¶ç¦ç”¨æŸä¸ªç©æ³•çš„é™èµ”ï¼Ÿ

**Aï¼š** ä¸¤ç§æ–¹æ³•ï¼š

**æ–¹æ³• 1ï¼šä¿®æ”¹é…ç½®**
```sql
UPDATE x_auto SET ifok=0
WHERE gid='100' AND class='ä¸¤é¢';
```

**æ–¹æ³• 2ï¼šè®¾ç½®æé«˜çš„è§¦å‘é‡‘é¢**
```sql
UPDATE x_auto SET startje=9999999
WHERE gid='100' AND class='ä¸¤é¢';
```

---

### Q6ï¼šé™èµ”åå¦‚ä½•æ‰‹åŠ¨æ¢å¤èµ”ç‡ï¼Ÿ

**Aï¼š** æ‰§è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- æ–¹æ³•1ï¼šæ¢å¤åˆ°åŸå§‹èµ”ç‡
UPDATE x_play SET
    peilv1 = mp1,     -- æ¢å¤åŸå§‹èµ”ç‡
    ystart = 0,       -- é‡ç½®æ ‡å¿—
    yautocs = 0       -- æ¸…é›¶æ¬¡æ•°
WHERE gid='100';

-- æ–¹æ³•2ï¼šæ‰‹åŠ¨è®¾ç½®èµ”ç‡
UPDATE x_play SET
    peilv1 = 1.95,
    ystart = 0,
    yautocs = 0
WHERE gid='100' AND pid='23378685';

-- è®°å½•æ‰‹åŠ¨è°ƒæ•´æ—¥å¿—
INSERT INTO x_peilv SET
    gid='100',
    pid='23378685',
    peilv='0.05',     -- æ­£æ•°è¡¨ç¤ºä¸Šè°ƒ
    time=NOW(),
    userid='10001001',
    auto=0;
```

---

## åã€æµ‹è¯•ç”¨ä¾‹

### ğŸ§ª **è‡ªåŠ¨é™èµ”æµ‹è¯•**

#### **æµ‹è¯•ç”¨ä¾‹ 1ï¼šåŸºæœ¬é™èµ”æµç¨‹**

**å‰ç½®æ¡ä»¶**ï¼š
- é…ç½®ï¼šstartje=10000, startpeilv=0.01, addje=5000, attpeilv=0.02, lowpeilv=1.80
- åˆå§‹èµ”ç‡ï¼š1.95

**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ¨¡æ‹ŸæŠ•æ³¨ 10000 å…ƒ
2. æ‰§è¡Œ `attpeilvs(100)`
3. æŸ¥è¯¢ `x_play.peilv1`

**é¢„æœŸç»“æœ**ï¼š
- èµ”ç‡ = 1.95 - 0.01 = **1.94**
- `ystart` = 1
- `yautocs` = 1
- `x_peilv` è¡¨æ–°å¢ä¸€æ¡è®°å½•ï¼Œ`peilv` = -0.01

---

#### **æµ‹è¯•ç”¨ä¾‹ 2ï¼šè¿ç»­é™èµ”**

**å‰ç½®æ¡ä»¶**ï¼šåŒä¸Š

**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ¨¡æ‹ŸæŠ•æ³¨ 25000 å…ƒ
2. æ‰§è¡Œ `attpeilvs(100)`
3. æŸ¥è¯¢ `x_play.peilv1`

**é¢„æœŸç»“æœ**ï¼š
- é™èµ”æ¬¡æ•° = (25000-10000)/5000 + 1 = 4
- èµ”ç‡ = 1.95 - 0.01 - (4-1)Ã—0.02 = **1.88**
- `yautocs` = 4

---

#### **æµ‹è¯•ç”¨ä¾‹ 3ï¼šè¾¾åˆ°æœ€ä½èµ”ç‡**

**å‰ç½®æ¡ä»¶**ï¼šåŒä¸Š

**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ¨¡æ‹ŸæŠ•æ³¨ 50000 å…ƒ
2. æ‰§è¡Œ `attpeilvs(100)`
3. æŸ¥è¯¢ `x_play.peilv1`

**é¢„æœŸç»“æœ**ï¼š
- è®¡ç®—èµ”ç‡ = 1.95 - 0.01 - 8Ã—0.02 = 1.78
- å®é™…èµ”ç‡ = MAX(1.78, 1.80) = **1.80**ï¼ˆæœ€ä½èµ”ç‡ï¼‰

---

### ğŸ§ª **é£å•æµ‹è¯•**

#### **æµ‹è¯•ç”¨ä¾‹ 4ï¼šåŸºæœ¬é£å•æµç¨‹**

**å‰ç½®æ¡ä»¶**ï¼š
- é£å•é˜ˆå€¼ï¼š5000
- å•æ¬¡æœ€å¤§ï¼š10000
- ä¸‹çº§æŠ•æ³¨æ€»å æˆï¼š12000

**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ¨¡æ‹Ÿä¸‹çº§æŠ•æ³¨
2. æ‰§è¡Œ `autoflys_ss.php`
3. æŸ¥è¯¢é£å•è®°å½•

**é¢„æœŸç»“æœ**ï¼š
- é£å•é‡‘é¢ = 12000 - 5000 = **7000**
- `x_lib` è¡¨æ–°å¢ä¸€æ¡è®°å½•ï¼Œ`userid`=99999999, `flytype`=1, `je`=7000

---

## åä¸€ã€æ€»ç»“

### ğŸ“Š **åŠŸèƒ½å®ç°æƒ…å†µ**

| åŠŸèƒ½ | å®ç°çŠ¶æ€ | æ ¸å¿ƒæ–‡ä»¶ | æ•°æ®è¡¨ | è§¦å‘æ—¶æœº |
|------|---------|---------|--------|---------|
| âœ… è‡ªåŠ¨é™èµ” | **å·²å®ç°** | `func/adminfunc.php:620` | `x_auto`, `x_play`, `x_peilv` | æ¯æ¬¡å¼€ç›˜ |
| âœ… å¼€å¥–åé‡ç½® | **å·²å®ç°** | `func/adminfunc.php:737` | `x_play` | æ¯æ¬¡å¼€å¥– |
| âœ… è‡ªåŠ¨é£å• | **å·²å®ç°** | `tools/autoflys_ss.php:238` | `x_lib`, `x_fly` | æ¯10ç§’ |
| âœ… åŒ…ç æ§åˆ¶ | **å·²å®ç°** | é…ç½®å¼€å…³ | `x_config` | ç³»ç»Ÿè‡ªåŠ¨ |
| âœ… æ‰‹åŠ¨é™èµ” | **å·²å®ç°** | `hide/libset.php` | `x_play` | æ‰‹åŠ¨æ“ä½œ |
| âš ï¸ å®æ—¶ç›‘æ§ | **éƒ¨åˆ†å®ç°** | `hide/caopan.php` | - | æ‰‹åŠ¨æŸ¥çœ‹ |
| âŒ æ™ºèƒ½é¢„è­¦ | **æœªå®ç°** | - | - | - |
| âŒ é…ç½®å®¡æ ¸ | **æœªå®ç°** | - | - | - |

---

### ğŸ¯ **æ ¸å¿ƒä»·å€¼**

é€šè¿‡æ™ºèƒ½åŒ–çš„é£é™©æ§åˆ¶æœºåˆ¶ï¼Œç³»ç»Ÿèƒ½å¤Ÿï¼š

1. **è‡ªåŠ¨å¹³è¡¡é£é™©**ï¼šæŠ•æ³¨é›†ä¸­æ—¶è‡ªåŠ¨é™ä½èµ”ç‡
2. **é˜²æ­¢å¤§é¢äºæŸ**ï¼šé£å•æœºåˆ¶åˆ†æ•£é£é™©åˆ°ä¸Šçº§
3. **çµæ´»é…ç½®**ï¼šæ”¯æŒæŒ‰æ¸¸æˆã€ç©æ³•åˆ†åˆ«é…ç½®
4. **å®¡è®¡è¿½æº¯**ï¼šå®Œæ•´çš„èµ”ç‡å˜æ›´æ—¥å¿—

---

### âš ï¸ **å…³é”®æ³¨æ„äº‹é¡¹**

1. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å»ºè®®æ·»åŠ æ•°æ®åº“ç´¢å¼•
   - ä½¿ç”¨ Redis ç¼“å­˜é…ç½®
   - è€ƒè™‘å¼‚æ­¥å¤„ç†

2. **å®‰å…¨åŠ å›º**ï¼š
   - æ·»åŠ æƒé™éªŒè¯
   - ä½¿ç”¨é¢„å¤„ç†è¯­å¥é˜² SQL æ³¨å…¥
   - æ·»åŠ æ“ä½œå®¡è®¡

3. **ä¸šåŠ¡é£é™©**ï¼š
   - åˆç†è®¾ç½®é™èµ”å‚æ•°ï¼Œé¿å…ç”¨æˆ·æµå¤±
   - ç›‘æ§é£å•æˆåŠŸç‡
   - å®šæœŸå®¡æŸ¥é…ç½®

---

### ğŸ“š **ç›¸å…³æ–‡æ¡£**

- [å¼€å¥–é‡‡é›†åŠŸèƒ½æ–‡æ¡£](./å¼€å¥–é‡‡é›†.md)
- [é£å•å¯¹å†²åŠŸèƒ½æ–‡æ¡£](./é£å•å¯¹å†².md)
- [æ•°æ®åº“è¡¨ç»“æ„æ–‡æ¡£](./æ•°æ®åº“è®¾è®¡.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-11-09
**ç»´æŠ¤è€…**ï¼šæŠ€æœ¯å›¢é˜Ÿ
**è”ç³»æ–¹å¼**ï¼štech@example.com
