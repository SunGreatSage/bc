# 功能开发需求文档

> **文档版本**：v1.0
> **创建日期**：2025-11-24
> **项目**：houtai_nyedCc 彩票后台管理系统

---

## 一、需求概述

### 1.1 背景说明

客户希望简化现有彩票系统，仅保留**三种核心玩法**，并参照已有的参考盘口进行界面优化和功能调整。

### 1.2 核心需求清单

| 序号 | 需求项 | 优先级 | 说明 |
|------|--------|--------|------|
| 1 | 仅保留三种玩法 | 高 | 其他玩法暂时关闭或隐藏 |
| 2 | 特码界面优化 | 高 | 从一排3个改为一排5个 |
| 3 | 新增"六小/五小/四小/三小"玩法 | 高 | 包含界面和倍数配置 |
| 4 | 封盘时间调整 | 高 | 开放时间6:00之后，封盘9:30，开奖9:50 |
| 5 | 开奖动画效果 | 中 | 号码一个一个掉落显示 |
| 6 | 代理后台配置 | 中 | 代理开通给前台的操作流程 |
| 7 | 操作教程 | 低 | 提供小视频/照片+文字说明 |

---

## 二、功能详细说明

### 2.1 玩法精简（仅保留三种）

**需求描述**：
- 客户明确表示"只做这三种，其他的太复杂了"
- 需要隐藏或禁用其他所有玩法

**现有玩法表结构**：
- `x_bclass`：大盘分类
- `x_class`：子盘分类
- `x_play`：具体玩法和赔率

**实现方案**：

#### 方案A：软禁用（推荐）
在数据库中添加启用/禁用状态字段，保留数据但前端不显示。

```sql
-- 为玩法分类表添加状态字段
ALTER TABLE `x_bclass` ADD COLUMN `is_enabled` TINYINT(1) DEFAULT 1 COMMENT '是否启用：0禁用，1启用';
ALTER TABLE `x_class` ADD COLUMN `is_enabled` TINYINT(1) DEFAULT 1 COMMENT '是否启用：0禁用，1启用';
```

#### 方案B：后台配置开关
在游戏配置（`x_game.cs` JSON字段）中增加启用的玩法列表。

**待确认**：
- [ ] 具体保留哪三种玩法？（需客户提供参考盘口截图或明确说明）

---

### 2.2 特码界面优化

**需求描述**：
- 现有特码显示为"一排3个"
- 参考盘口为"一排5个，更好用"

**涉及文件**：
- `templates/default/uxj/101.html`（PC端特码投注界面）
- `templates/default/mxj/101.html`（移动端特码投注界面）
- 相关CSS样式文件

**实现方案**：

```html
<!-- 修改前：一排3个 -->
<div class="tema-row">
    <div class="tema-item">01</div>
    <div class="tema-item">02</div>
    <div class="tema-item">03</div>
</div>

<!-- 修改后：一排5个 -->
<div class="tema-row">
    <div class="tema-item">01</div>
    <div class="tema-item">02</div>
    <div class="tema-item">03</div>
    <div class="tema-item">04</div>
    <div class="tema-item">05</div>
</div>
```

**CSS调整**：
```css
.tema-row {
    display: flex;
    flex-wrap: wrap;
}
.tema-item {
    width: 20%; /* 一排5个 = 100%/5 */
    box-sizing: border-box;
}
```

---

### 2.3 新增"六小/五小/四小/三小"玩法

**需求描述**：
客户要求新增以下玩法及其倍数配置：
- 六小（6个小号）
- 五小（5个小号）
- 四小（4个小号）
- 三小（3个小号）

**玩法规则说明**：
| 玩法 | 规则描述 | 判定条件 |
|------|----------|----------|
| 六小 | 开奖的6个正码全部为小号（01-24） | m1-m6 均 ≤ 24 |
| 五小 | 开奖的6个正码中有5个为小号 | m1-m6 中恰好5个 ≤ 24 |
| 四小 | 开奖的6个正码中有4个为小号 | m1-m6 中恰好4个 ≤ 24 |
| 三小 | 开奖的6个正码中有3个为小号 | m1-m6 中恰好3个 ≤ 24 |

> 注：小号定义为 1-24，大号定义为 25-49

**数据库修改**：

```sql
-- 1. 新增玩法分类（如果需要单独分类）
INSERT INTO `x_bclass` (bid, bname, gid, sort, is_enabled)
VALUES (新bid, '大小玩法', 目标gid, 排序值, 1);

-- 2. 新增子分类
INSERT INTO `x_class` (sid, sname, bid, sort, is_enabled)
VALUES (新sid, '正码大小', 上述bid, 排序值, 1);

-- 3. 新增具体玩法
INSERT INTO `x_play` (pid, pname, gid, bid, sid, peilv1, peilv2, pl, mpl) VALUES
(新pid1, '六小', gid, bid, sid, 赔率1, 赔率2, 'JSON赔率', 'JSON赔率'),
(新pid2, '五小', gid, bid, sid, 赔率1, 赔率2, 'JSON赔率', 'JSON赔率'),
(新pid3, '四小', gid, bid, sid, 赔率1, 赔率2, 'JSON赔率', 'JSON赔率'),
(新pid4, '三小', gid, bid, sid, 赔率1, 赔率2, 'JSON赔率', 'JSON赔率');
```

**结算逻辑修改**：

文件：`func/self.php`（结算核心）

```php
// 新增判断函数
function countSmallNumbers($m1, $m2, $m3, $m4, $m5, $m6) {
    $count = 0;
    $numbers = [$m1, $m2, $m3, $m4, $m5, $m6];
    foreach ($numbers as $num) {
        if ($num >= 1 && $num <= 24) {
            $count++;
        }
    }
    return $count;
}

// 在结算逻辑中添加
case '六小':
    $smallCount = countSmallNumbers($m1, $m2, $m3, $m4, $m5, $m6);
    $isWin = ($smallCount == 6);
    break;
case '五小':
    $smallCount = countSmallNumbers($m1, $m2, $m3, $m4, $m5, $m6);
    $isWin = ($smallCount == 5);
    break;
case '四小':
    $smallCount = countSmallNumbers($m1, $m2, $m3, $m4, $m5, $m6);
    $isWin = ($smallCount == 4);
    break;
case '三小':
    $smallCount = countSmallNumbers($m1, $m2, $m3, $m4, $m5, $m6);
    $isWin = ($smallCount == 3);
    break;
```

**待确认**：
- [ ] 具体赔率倍数是多少？（需客户提供参考盘口的倍数配置）
- [ ] 是否需要对应的"六大/五大/四大/三大"玩法？

---

### 2.4 封盘时间调整

**需求描述**：
- 盘口开放时间：6:00 之后可以打开
- 封盘时间：9:30
- 开奖时间：9:50

**现有时间配置位置**：
1. 游戏表 `x_game` 中的配置
2. 开奖表 `x_kj` 中的 `opentime`、`closetime`、`kjtime` 字段

**实现方案**：

#### 1. 修改游戏配置
文件：`hide/game.php`

```php
// 更新游戏的默认时间配置
$game['closetimekj'] = '09:30:00';  // 封盘时间
// 开奖时间 = 封盘时间 + 20分钟 = 09:50:00
```

#### 2. 批量更新未开奖期次
```sql
-- 更新所有未开奖期次的时间
UPDATE `x_kj` SET
    opentime = CONCAT(dates, ' 06:00:00'),
    closetime = CONCAT(dates, ' 09:30:00'),
    kjtime = CONCAT(dates, ' 09:50:00')
WHERE js = 0 AND gid = 目标游戏ID;
```

#### 3. 前端封盘提示
文件：`uxj/time.php`、`mxj/time.php`

```php
// 计算封盘倒计时
$closetime = strtotime($kj['closetime']);
$now = time();
$remaining = $closetime - $now;

if ($remaining <= 0) {
    echo "已封盘，等待开奖";
} else {
    echo "距离封盘还有：" . formatTime($remaining);
}
```

---

### 2.5 开奖动画效果

**需求描述**：
- 开奖时号码"一个一个数字掉下来"
- 参考盘口的开奖展示效果

**实现方案**：

#### 前端动画（JavaScript + CSS）

```javascript
// 开奖动画函数
function showKjAnimation(numbers) {
    const container = document.getElementById('kj-result');
    container.innerHTML = '';

    numbers.forEach((num, index) => {
        setTimeout(() => {
            const ball = document.createElement('div');
            ball.className = 'kj-ball drop-animation';
            ball.textContent = num.toString().padStart(2, '0');
            ball.style.backgroundColor = getBallColor(num);
            container.appendChild(ball);
        }, index * 500); // 每个号码间隔500ms
    });
}
```

```css
/* 掉落动画 */
@keyframes dropIn {
    0% {
        transform: translateY(-100px);
        opacity: 0;
    }
    60% {
        transform: translateY(10px);
    }
    100% {
        transform: translateY(0);
        opacity: 1;
    }
}

.drop-animation {
    animation: dropIn 0.5s ease-out forwards;
}

.kj-ball {
    display: inline-block;
    width: 40px;
    height: 40px;
    line-height: 40px;
    text-align: center;
    border-radius: 50%;
    color: white;
    font-weight: bold;
    margin: 0 5px;
}
```

**涉及文件**：
- `templates/default/uxj/kj.html`
- `templates/default/mxj/kj.html`
- `js/default/` 相关JS文件

---

### 2.6 代理后台配置

**需求描述**：
- 说明"代理后台怎么操作开给代理前台"

**现有代理后台功能**：
- 位置：`agent/` 目录
- 主要功能：用户管理、投注记录、报表统计、警示配置

**操作流程文档**：

#### 系统管理员开通代理账号流程

1. **登录系统管理员后台**
   - 访问：`http://域名/hide/`
   - 使用管理员账号登录

2. **创建代理账号**
   - 进入：用户管理 → 新增用户
   - 设置用户类型为"代理"
   - 填写代理信息（用户名、密码、联系方式等）

3. **配置代理权限**
   - 设置代理可管理的游戏
   - 设置代理佣金比例
   - 设置代理下级额度限制

4. **代理登录**
   - 代理访问：`http://域名/agent/`
   - 使用分配的账号密码登录

#### 代理开通下级用户流程

1. **代理登录后台**
   - 访问：`http://域名/agent/`

2. **新增下级用户**
   - 进入：用户管理 → 新增用户
   - 填写用户信息
   - 设置用户额度

3. **提供登录信息给用户**
   - PC端：`http://域名/uxj/`
   - 移动端：`http://域名/mxj/`

---

## 三、技术实现方案

### 3.1 涉及文件清单

| 模块 | 文件路径 | 修改内容 |
|------|----------|----------|
| 玩法配置 | `data/db.php` | 新增玩法表数据 |
| 结算逻辑 | `func/self.php` | 新增六小/五小等结算判断 |
| PC投注界面 | `templates/default/uxj/101.html` | 特码布局调整 |
| 移动投注界面 | `templates/default/mxj/101.html` | 特码布局调整 |
| 开奖展示 | `templates/default/uxj/kj.html` | 开奖动画 |
| 时间配置 | `hide/game.php` | 封盘/开奖时间 |
| 时间接口 | `uxj/time.php` | 封盘状态判断 |

### 3.2 数据库修改

```sql
-- 创建备份（重要！）
CREATE TABLE x_play_backup_20251124 AS SELECT * FROM x_play;
CREATE TABLE x_bclass_backup_20251124 AS SELECT * FROM x_bclass;
CREATE TABLE x_class_backup_20251124 AS SELECT * FROM x_class;

-- 后续SQL见各功能模块说明
```

### 3.3 测试计划

| 测试项 | 测试内容 | 预期结果 |
|--------|----------|----------|
| 玩法显示 | 前台只显示三种玩法 | 其他玩法不显示 |
| 特码布局 | 一排显示5个号码 | 布局正确，响应式适配 |
| 六小投注 | 投注六小玩法 | 投注成功，记录正确 |
| 六小结算 | 开奖6个小号 | 正确判定中奖 |
| 封盘时间 | 9:30后访问投注 | 显示已封盘 |
| 开奖动画 | 开奖时查看 | 号码逐个掉落 |

---

## 四、交付物清单

### 4.1 代码交付

- [ ] 玩法精简实现
- [ ] 特码界面优化（一排5个）
- [ ] 六小/五小/四小/三小玩法及结算
- [ ] 封盘时间配置（6:00开放，9:30封盘，9:50开奖）
- [ ] 开奖掉落动画

### 4.2 文档交付

- [ ] 操作教程（文字版）
- [ ] 操作教程（截图版）
- [ ] 操作演示视频（可选）

### 4.3 操作教程大纲

1. **系统管理员操作**
   - 如何配置游戏时间
   - 如何管理玩法开关
   - 如何开通代理账号

2. **代理操作**
   - 如何登录代理后台
   - 如何开通下级用户
   - 如何查看报表

3. **用户操作**
   - 如何登录投注
   - 如何选择玩法下注
   - 如何查看开奖结果

---

## 五、待确认事项

> ⚠️ 以下内容需要客户进一步确认

1. **保留的三种玩法**：具体是哪三种？
   - 选项A：特码 + 正码 + 六小系列
   - 选项B：需要客户提供参考盘口截图确认

2. **赔率配置**：六小/五小/四小/三小的具体赔率是多少？
   - 需要客户提供参考盘口的赔率表

3. **是否需要对应的"大"系列**：
   - 六大/五大/四大/三大是否需要？

4. **界面风格**：是否需要完全按照参考盘口的样式？
   - 如需要，请提供详细截图

5. **测试环境**：是否有测试服务器？
   - 便于开发过程中测试验证

---

## 六、开发排期（预估）

| 阶段 | 任务 | 预计工时 |
|------|------|----------|
| 第1天 | 玩法精简 + 数据库修改 | 4小时 |
| 第2天 | 特码界面优化 + 六小系列玩法 | 6小时 |
| 第3天 | 结算逻辑 + 封盘时间 | 4小时 |
| 第4天 | 开奖动画 + 联调测试 | 4小时 |
| 第5天 | 操作教程制作 + 交付 | 3小时 |

**总计**：约 21 工时（3-5个工作日）

---

## 附录

### A. 参考资料

- 项目文档：`/doc/CLAUDE.md`
- 开奖文档：`/doc/开奖.md`
- 控盘文档：`/doc/控盘.md`

### B. 联系方式

如有疑问，请联系开发团队。

---

**文档状态**：待客户确认
**下次更新**：待客户反馈后更新具体实现细节
